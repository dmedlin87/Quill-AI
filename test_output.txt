
[1m[46m RUN [49m[22m [36mv4.0.15 [39m[90mC:/Users/dmedl/Projects/Quill AI[39m

 [31mÎ“Â¥Â»[39m tests/services/appBrain/contextBuilder.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 32[2mms[22m[39m
     [32mÎ“Â£Ã´[39m builds a rich markdown context with manuscript, ui, hud, analysis, lore, events, history and session[32m 13[2mms[22m[39m
     [32mÎ“Â£Ã´[39m omits optional sections when data is missing[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m serializes context as JSON when using the API template[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m renders an XML context when requested[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m skips HUD and session data when those sections are absent[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m includes voice fingerprint metrics when deep analysis is requested[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m handles alternate UI states (zen mode off, no scene, no transcript, zen off)[32m 1[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m handles partial analysis results[39m[32m 8[2mms[22m[39m
     [32mÎ“Â£Ã´[39m handles lore inconsistencies[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m returns base context unchanged when projectId is null[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m replaces memory placeholder with formatted memories and goals in markdown[32m 1[2mms[22m[39m
     [32mÎ“Â£Ã´[39m injects memory into JSON template and falls back when parsing fails[32m 1[2mms[22m[39m
     [32mÎ“Â£Ã´[39m injects memory into XML template[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m handles memory service failures gracefully by leaving placeholder or warning[32m 1[2mms[22m[39m
     [32mÎ“Â£Ã´[39m builds compressed context with key markers[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m builds navigation context with chapters, characters, and scene types[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m builds editing context with selection, style, and branch info[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m omits HUD-specific markers in compressed context when HUD is missing[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m builds navigation context even without intelligence entities or structural data[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m gracefully builds editing context without selection or branch info[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m creates a context builder bound to getState[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m builds relevance from state when not provided and calls adaptive context helpers[32m 1[2mms[22m[39m
     [32mÎ“Â£Ã´[39m honors explicit relevance overrides and model role[32m 0[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/services/appBrain/contextBuilder.test.ts > contextBuilder - coverage gaps > handles partial analysis results
AssertionError: expected '[MANUSCRIPT STATE]\nProject: Novel\nCÎ“Ã‡Âª' to contain '[ANALYSIS INSIGHTS]'

- Expected
+ Received

- [ANALYSIS INSIGHTS]
+ [MANUSCRIPT STATE]
+ Project: Novel
+ Chapters: 2
+ Active Chapter: "One" (20 chars)
+ Setting: Now, Here
+ Branches: 1 (on branch)
+
+ [CURRENT USER STATE]
+ Cursor Position: 10 (intro scene)
+ Selection: "Hello world, this is a longish selection." [0-5]
+ Active Panel: chat
+ View Mode: editor (Zen Mode)
+ Mic: idle (heard: "Dictated note here that is somewhat long")
+
+ [INTELLIGENCE HUD]
+ Scene: intro, POV: Alice, Location: Hall
+ Tension: MEDIUM
+ Pacing: steady
+ Progress: Scene 1 of 3 (33%)
+
+ Active Characters:
+ Î“Ã‡Ã³ Alice (character) - 3 mentions
+ Î“Ã‡Ã³ Bob (character) - 1 mentions
+
+ Key Relationships:
+ Î“Ã‡Ã³ Alice Î“Ã¥Ã‰allyÎ“Ã¥Ã† Bob
+
+ Open Plot Threads:
+ Î“ÃœÃ­ [MYSTERY] Who is the stranger?...
+
+ Style Alerts:
+ Î“ÃœÃ¡âˆ©â••Ã… Watch for repetition
+
+ Priority Issues:
+ â‰¡Æ’Ã¶â”¤ Slow start
+
+ [INLINE COMMENTS]
+ Active Inline Comments: 1
+
+ [LORE BIBLE]
+ Characters (1):
+ Î“Ã‡Ã³ Alice: Hero of the tale...
+
+ World Rules (1):
+ Î“Ã‡Ã³ Magic is rare...
+
+ [RECENT ACTIVITY]
+ Evt 1
+ Evt 2
+
+ [RECENT AGENT ACTIONS]
+ Cmd 1
+ Cmd 2
+
+ [AGENT MEMORY]
+ (Memory context loaded separately - see buildAgentContextWithMemory)
+
+ [LAST AGENT ACTION]
+ rewrite: Rewrote opening paragraph
+ Result: Success
+
+ [STATS]
+ Words: 1,000 | Reading: ~5 min | Dialogue: 20% | Avg Sentence: 12 words

 Î“Â¥Â» tests/services/appBrain/contextBuilder.test.ts:306:18
    304|      
    305|      const ctx = buildAgentContext(state);
    306|      expect(ctx).toContain('[ANALYSIS INSIGHTS]');
       |                  ^
    307|      // Should be empty or just headers? 
    308|      // Code: if (result.summary) ... if (strengths) ...

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m22 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 16:16:45
[2m   Duration [22m 1.80s[2m (transform 414ms, setup 408ms, import 454ms, tests 32ms, environment 712ms)[22m

JSON report written to C:/Users/dmedl/Projects/Quill AI/coverage/vitest-report.json
