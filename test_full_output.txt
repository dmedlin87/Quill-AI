
> quill-ai@0.0.0 test:full
> npm run test:coverage && npm run test:audit


> quill-ai@0.0.0 test:coverage
> cross-env NODE_OPTIONS=--max-old-space-size=8192 vitest run --coverage && npm run test:status


[1m[46m RUN [49m[22m [36mv4.0.15 [39m[90m/app[39m
      [2mCoverage enabled with [22m[33mv8[39m

 [32mâœ“[39m tests/services/intelligence/timelineTracker.test.ts [2m([22m[2m99 tests[22m[2m)[22m[32m 135[2mms[22m[39m
[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mprocesses urgent events immediately and batches non-urgent events
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mprocesses urgent events immediately and batches non-urgent events
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mclears timers and pending events on stop
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mclears timers and pending events on stop
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}
[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mclears timers and pending events on stop
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mis a no-op when disabled
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mis a no-op when disabled
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mis a no-op when disabled
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould be a singleton
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould be a singleton
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould subscribe to event bus on start
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould subscribe to event bus on start
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould subscribe to event bus on start
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould unsubscribe on stop
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould unsubscribe on stop
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}
[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould unsubscribe on stop
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould trigger thinking after debounce when events accumulate
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould trigger thinking after debounce when events accumulate
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould trigger thinking after debounce when events accumulate
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould trigger immediately for urgent events
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould trigger immediately for urgent events
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould trigger immediately for urgent events
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould detect voice drift
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould detect voice drift
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould detect voice drift
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould not detect voice drift if deviation is low
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould not detect voice drift if deviation is low
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould not detect voice drift if deviation is low
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould handle AI errors gracefully
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould handle AI errors gracefully
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould handle AI errors gracefully
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould use long term memory context
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould use long term memory context
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould use long term memory context
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould detect timeline conflicts
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould detect timeline conflicts
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould detect timeline conflicts
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould detect lore suggestions
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould detect lore suggestions
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould detect lore suggestions
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould handle chapter transition with issues and watched entities
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould handle chapter transition with issues and watched entities
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould handle chapter transition with issues and watched entities
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mhandles chapter transition with no issues or watched entities
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mhandles chapter transition with no issues or watched entities
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mhandles chapter transition with no issues or watched entities
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mformats chapter issues and watched entities without optional metadata
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mformats chapter issues and watched entities without optional metadata
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mformats chapter issues and watched entities without optional metadata
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould evolve bedside note when reminders are present
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould evolve bedside note when reminders are present
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould evolve bedside note when reminders are present
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould apply adaptive relevance weights correctly
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould apply adaptive relevance weights correctly
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould apply adaptive relevance weights correctly
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould prioritize suggestions based on configured weights
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould prioritize suggestions based on configured weights
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould prioritize suggestions based on configured weights
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould fetch long term memory context with matches
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould fetch long term memory context with matches
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould fetch long term memory context with matches
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould handle no long term memory matches
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould handle no long term memory matches
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould handle no long term memory matches
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould handle malformed AI responses gracefully
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould handle malformed AI responses gracefully
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould handle malformed AI responses gracefully
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcaps pending events at maxBatchSize
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcaps pending events at maxBatchSize
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}
[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcaps pending events at maxBatchSize
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mlogs bedside evolve failures during thinking
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mlogs bedside evolve failures during thinking
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mlogs bedside evolve failures during thinking
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mreturns null when forcing think without setup or events
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mreturns null when forcing think without setup or events
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mreturns null when forcing think without setup or events
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould evolve bedside note on significant edit after cooldown
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould evolve bedside note on significant edit after cooldown
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould evolve bedside note on significant edit after cooldown
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mincludes active chapter details when evolving bedside note for significant edits
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mincludes active chapter details when evolving bedside note for significant edits
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mincludes active chapter details when evolving bedside note for significant edits
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mdoes not trigger conflict detection when within timeline check cooldown
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mdoes not trigger conflict detection when within timeline check cooldown
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mdoes not trigger conflict detection when within timeline check cooldown
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mdoes not trigger conflict detection when no temporal markers are found
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mdoes not trigger conflict detection when no temporal markers are found
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mdoes not trigger conflict detection when no temporal markers are found
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mextractDialogueBlocks skips empty quotes
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mextractDialogueBlocks skips empty quotes
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2minferDialogueSpeaker uses attribution fallback and returns candidate when unknown
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2minferDialogueSpeaker uses attribution fallback and returns candidate when unknown
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2minferDialogueSpeaker returns exact known character when attribution matches case-insensitively
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2minferDialogueSpeaker returns exact known character when attribution matches case-insensitively
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2minjects detected conflicts into proactive thinking prompt
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2minjects detected conflicts into proactive thinking prompt
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2minjects detected conflicts into proactive thinking prompt
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mskips bedside evolve when significant but there are no suggestions or reminders
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mskips bedside evolve when significant but there are no suggestions or reminders
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mskips bedside evolve when significant but there are no suggestions or reminders
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mformats empty event list for prompt
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mformats empty event list for prompt
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mmutes suggestions when adaptive weight is near zero
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mmutes suggestions when adaptive weight is near zero
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould check timeline conflicts on significant edit after cooldown
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould check timeline conflicts on significant edit after cooldown
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mshould check timeline conflicts on significant edit after cooldown
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdoes not start when disabled via config
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdoes not start when disabled via config
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mforceThink returns null if not initialized
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mforceThink returns null if not initialized
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mmaybeUpdateBedsideNotes handles missing dependencies
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mmaybeUpdateBedsideNotes handles missing dependencies
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mhandleSignificantEdit respects threshold and cooldown
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mhandleSignificantEdit respects threshold and cooldown
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mhandleSignificantEdit respects threshold and cooldown
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdetectConflicts exits early on missing data
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdetectConflicts exits early on missing data
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdetectConflicts exits early on missing data
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdetectConflicts handles missing baseText
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdetectConflicts handles missing baseText
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdetectConflicts handles missing baseText
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdetectConflicts handles new marker (no previous)
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdetectConflicts handles new marker (no previous)
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdetectConflicts handles new marker (no previous)
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdetectVoiceConsistency handles missing data
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdetectVoiceConsistency handles missing data
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdetectVoiceConsistency handles missing data
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdetectLoreSuggestions exits early
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdetectLoreSuggestions exits early
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mdetectLoreSuggestions exits early
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mparseThinkingResult handles invalid JSON
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mparseThinkingResult handles invalid JSON
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstderr[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mparseThinkingResult handles invalid JSON
[22m[39m[AppBrain][ProactiveThinker] Failed to parse thinking result

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mparseThinkingResult handles invalid JSON
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mclearDebounceTimer handles null timer
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mclearDebounceTimer handles null timer
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mclearDebounceTimer handles null timer
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mcanEvolveBedside handles config disabled
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mcanEvolveBedside handles config disabled
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mcanEvolveBedside handles config disabled
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mmaybeEvolveBedsideNote checks projectId and evolve capability
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mmaybeEvolveBedsideNote checks projectId and evolve capability
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mapplyAdaptiveRelevance mutes and reprioritizes suggestions using weights
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mapplyAdaptiveRelevance mutes and reprioritizes suggestions using weights
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mgetSuggestionCategory maps related_memory tags and falls back to other
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mgetSuggestionCategory maps related_memory tags and falls back to other
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mformatAge emits day/hour/minute/just-now variants
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mCoverage Expansions[2m > [22m[2mformatAge emits day/hour/minute/just-now variants
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - voice consistency + chapter transitions[2m > [22m[2mcreates chapter transition bedside updates with optional severity/priority/reason fields
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - voice consistency + chapter transitions[2m > [22m[2mcreates chapter transition bedside updates with optional severity/priority/reason fields
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - voice consistency + chapter transitions[2m > [22m[2mcreates chapter transition bedside updates with optional severity/priority/reason fields
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - voice consistency + chapter transitions[2m > [22m[2mdetectVoiceConsistency emits suggestions when deviation is large
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - voice consistency + chapter transitions[2m > [22m[2mdetectVoiceConsistency emits suggestions when deviation is large
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - voice consistency + chapter transitions[2m > [22m[2mdetectVoiceConsistency emits suggestions when deviation is large
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - voice consistency + chapter transitions[2m > [22m[2mdetectVoiceConsistency returns early when quotes are too short to form dialogue blocks
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - voice consistency + chapter transitions[2m > [22m[2mdetectVoiceConsistency returns early when quotes are too short to form dialogue blocks
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - voice consistency + chapter transitions[2m > [22m[2mdetectVoiceConsistency returns early when quotes are too short to form dialogue blocks
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - voice consistency + chapter transitions[2m > [22m[2mdetectVoiceConsistency emits medium-priority drift and includes Higher/Lower diff text
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - voice consistency + chapter transitions[2m > [22m[2mdetectVoiceConsistency emits medium-priority drift and includes Higher/Lower diff text
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"project-123"}

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - voice consistency + chapter transitions[2m > [22m[2mdetectVoiceConsistency emits medium-priority drift and includes Higher/Lower diff text
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - voice consistency + chapter transitions[2m > [22m[2mcalculateVoiceDeviation treats two zero metrics as no deviation
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - voice consistency + chapter transitions[2m > [22m[2mcalculateVoiceDeviation treats two zero metrics as no deviation
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - parsing, lore suggestions, and long-term memory formatting[2m > [22m[2mparseThinkingResult handles missing fields and mapSuggestions applies defaults
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - parsing, lore suggestions, and long-term memory formatting[2m > [22m[2mparseThinkingResult handles missing fields and mapSuggestions applies defaults
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - parsing, lore suggestions, and long-term memory formatting[2m > [22m[2mdetectLoreSuggestions uses fallback description when no fact is available
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - parsing, lore suggestions, and long-term memory formatting[2m > [22m[2mdetectLoreSuggestions uses fallback description when no fact is available
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - parsing, lore suggestions, and long-term memory formatting[2m > [22m[2mfetchLongTermMemoryContext returns empty when projectId is missing
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - parsing, lore suggestions, and long-term memory formatting[2m > [22m[2mfetchLongTermMemoryContext returns empty when projectId is missing
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - parsing, lore suggestions, and long-term memory formatting[2m > [22m[2mfetchLongTermMemoryContext adds ellipsis for very long notes
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/services/appBrain/proactiveThinker.test.ts[2m > [22m[2mProactiveThinker[2m > [22m[2mcoverage gaps - parsing, lore suggestions, and long-term memory formatting[2m > [22m[2mfetchLongTermMemoryContext adds ellipsis for very long notes
[22m[39m[AppBrain][ProactiveThinker] Stopped

 [32mâœ“[39m tests/services/appBrain/proactiveThinker.test.ts [2m([22m[2m63 tests[22m[2m)[22m[33m 423[2mms[22m[39m
 [32mâœ“[39m tests/services/appBrain/adaptiveContext.test.ts [2m([22m[2m65 tests[22m[2m)[22m[32m 141[2mms[22m[39m
 [32mâœ“[39m tests/store/useProjectStore.test.ts [2m([22m[2m47 tests[22m[2m)[22m[32m 104[2mms[22m[39m
[90mstderr[2m | tests/services/appBrain/intelligenceMemoryBridge.test.ts[2m > [22m[2mintelligenceMemoryBridge[2m > [22m[2mdeduplication and sorting[2m > [22m[2msorts conflicts by severity (critical first)
[22m[39m[IntelligenceMemoryBridge] Failed to create memory: Error: DB error
    at [90m/app/[39mtests/services/appBrain/intelligenceMemoryBridge.test.ts:1073:60
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

 [32mâœ“[39m tests/services/appBrain/intelligenceMemoryBridge.test.ts [2m([22m[2m33 tests[22m[2m)[22m[32m 52[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/chains.test.ts [2m([22m[2m44 tests[22m[2m)[22m[32m 88[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/contradictionDetector.test.ts [2m([22m[2m51 tests[22m[2m)[22m[32m 44[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/chunkIndex.test.ts [2m([22m[2m71 tests[22m[2m)[22m[32m 45[2mms[22m[39m
 [32mâœ“[39m tests/services/gemini/agentTools.test.ts [2m([22m[2m134 tests[22m[2m)[22m[32m 87[2mms[22m[39m
 [32mâœ“[39m tests/components/ImportWizard.test.tsx [2m([22m[2m54 tests[22m[2m)[22m[33m 3764[2mms[22m[39m
[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveCharacters[2m > [22m[2mshould create memories for character arcs
[22m[39m[AutoObserver] Created 1 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveCharacters[2m > [22m[2mshould create memories for relationships
[22m[39m[AutoObserver] Created 1 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveCharacters[2m > [22m[2msupports string relationships and captures createMemory errors
[22m[39m[AutoObserver] Created 1 observations, skipped 0 duplicates, 1 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveCharacters[2m > [22m[2mshould skip duplicates if enabled
[22m[39m[AutoObserver] Created 0 observations, skipped 1 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveCharacters[2m > [22m[2mskips duplicates for relationships, inconsistencies, and development suggestions when checker returns true
[22m[39m[AutoObserver] Created 0 observations, skipped 3 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveCharacters[2m > [22m[2mpushes newly created notes into existingMemories when deduplication is enabled
[22m[39m[AutoObserver] Created 4 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveAnalysisResults[2m > [22m[2mskips duplicates when deduplication is enabled
[22m[39m[AutoObserver] Created 0 observations, skipped 3 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveAnalysisResults[2m > [22m[2mcreates observations for characters, plot issues, and pacing data
[22m[39m[AutoObserver] Created 7 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveAnalysisResults[2m > [22m[2mtruncates observations to maxObservations using highest importance values
[22m[39m[AutoObserver] Created 2 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveAnalysisResults[2m > [22m[2mcollects creation errors while continuing other observations
[22m[39m[AutoObserver] Created 1 observations, skipped 0 duplicates, 1 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobservePlotIssues[2m > [22m[2mshould create memories for plot issues
[22m[39m[AutoObserver] Created 1 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobservePacingFromAnalysis[2m > [22m[2mshould create memories for pacing issues
[22m[39m[AutoObserver] Created 2 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobservePacingFromAnalysis[2m > [22m[2mhandles missing slowSections/fastSections and supports string slow sections
[22m[39m[AutoObserver] Created 1 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveAll[2m > [22m[2mshould process both analysis and intelligence results
[22m[39m[AutoObserver] Created 0 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveAll[2m > [22m[2mhandles null intelligence gracefully
[22m[39m[AutoObserver] Created 0 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveCharacters edge cases[2m > [22m[2mskips characters with short arc text
[22m[39m[AutoObserver] Created 0 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveCharacters edge cases[2m > [22m[2mskips characters with short development suggestion
[22m[39m[AutoObserver] Created 0 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveCharacters edge cases[2m > [22m[2mhandles relationships as plain strings
[22m[39m[AutoObserver] Created 2 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobserveCharacters edge cases[2m > [22m[2mlimits relationships to 3 per character
[22m[39m[AutoObserver] Created 3 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobservePacingFromAnalysis edge cases[2m > [22m[2mhandles empty slow and fast sections
[22m[39m[AutoObserver] Created 0 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mobservePacingFromAnalysis edge cases[2m > [22m[2mlimits sections to 3 each
[22m[39m[AutoObserver] Created 6 observations, skipped 0 duplicates, 0 errors

[90mstdout[2m | tests/services/memory/autoObserver.test.ts[2m > [22m[2mAutoObserver Service[2m > [22m[2mdeduplication disabled[2m > [22m[2mdoes not fetch memories when deduplication is disabled
[22m[39m[AutoObserver] Created 1 observations, skipped 0 duplicates, 0 errors

 [32mâœ“[39m tests/services/memory/autoObserver.test.ts [2m([22m[2m40 tests[22m[2m)[22m[32m 53[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/entityExtractor.test.ts [2m([22m[2m46 tests[22m[2m)[22m[32m 53[2mms[22m[39m
[90mstderr[2m | tests/services/gemini/analysis.test.ts[2m > [22m[2manalyzeDraft[2m > [22m[2mhandles parse failure with fallback analysis
[22m[39m[analyzeDraft] Parse failed: Parse error
[analyzeDraft] Zod validation failed: { _errors: [ [32m'Invalid input: expected object, received null'[39m ] }

[90mstderr[2m | tests/services/gemini/analysis.test.ts[2m > [22m[2manalyzeDraft[2m > [22m[2mhandles Zod validation failure
[22m[39m[analyzeDraft] Zod validation failed: {
  _errors: [],
  strengths: { _errors: [ [32m'Invalid input: expected array, received string'[39m ] },
  pacing: { _errors: [], score: { _errors: [36m[Array][39m } }
}

[90mstderr[2m | tests/services/gemini/analysis.test.ts[2m > [22m[2mgeneratePlotIdeas[2m > [22m[2mhandles parse failure gracefully
[22m[39m[generatePlotIdeas] Parse failed: Parse error

 [32mâœ“[39m tests/services/gemini/analysis.test.ts [2m([22m[2m30 tests[22m[2m)[22m[32m 62[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/incrementalProcessor.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 32[2mms[22m[39m
 [32mâœ“[39m tests/components/RichTextEditor.test.tsx [2m([22m[2m27 tests[22m[2m)[22m[33m 344[2mms[22m[39m
 [32mâœ“[39m tests/services/gemini/toolExecutor.test.ts [2m([22m[2m43 tests[22m[2m)[22m[32m 66[2mms[22m[39m
[90mstdout[2m | tests/features/shared/hooks/useManuscriptIntelligence.test.ts[2m > [22m[2mWorker Integration[2m > [22m[2mposts to the worker and handles RESULT/ERROR messages, then cancels on unmount
[22m[39m[Intelligence] Worker ready

[90mstderr[2m | tests/features/shared/hooks/useManuscriptIntelligence.test.ts[2m > [22m[2mWorker Integration[2m > [22m[2mposts to the worker and handles RESULT/ERROR messages, then cancels on unmount
[22m[39m[Intelligence] Worker error: boom

 [32mâœ“[39m tests/features/shared/hooks/useManuscriptIntelligence.test.ts [2m([22m[2m34 tests[22m[2m)[22m[32m 175[2mms[22m[39m
 [32mâœ“[39m tests/features/memory/MemoryManager.test.tsx [2m([22m[2m35 tests[22m[2m)[22m[33m 4210[2mms[22m[39m
 [32mâœ“[39m tests/features/editor/hooks/useMagicEditor.test.tsx [2m([22m[2m30 tests[22m[2m)[22m[32m 230[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/cache.test.ts [2m([22m[2m52 tests[22m[2m)[22m[32m 50[2mms[22m[39m
[90mstderr[2m | tests/features/agent/hooks/useAgentOrchestrator.test.ts[2m > [22m[2museAgentOrchestrator[2m > [22m[2mhandles unexpected errors during message processing
[22m[39m[AgentOrchestrator] Error: Error: Network Error
    at [90m/app/[39mtests/features/agent/hooks/useAgentOrchestrator.test.ts:192:43
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/features/agent/hooks/useAgentOrchestrator.test.ts[2m > [22m[2museAgentOrchestrator[2m > [22m[2mvalidates malformed UI selection during fallback
[22m[39m[AgentOrchestrator] Smart context unavailable, using editor fallback: Error: Context fail
    at [90m/app/[39mtests/features/agent/hooks/useAgentOrchestrator.test.ts:308:57
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

 [32mâœ“[39m tests/services/appBrain/contextStreamer.test.ts [2m([22m[2m39 tests[22m[2m)[22m[32m 46[2mms[22m[39m
 [32mâœ“[39m tests/features/agent/components/ChatInterface.test.tsx [2m([22m[2m23 tests[22m[2m)[22m[33m 1904[2mms[22m[39m
[90mstderr[2m | tests/features/agent/hooks/useAgentOrchestrator.test.ts[2m > [22m[2museAgentOrchestrator[2m > [22m[2mhandles smart context failure gracefully
[22m[39m[AgentOrchestrator] Smart context unavailable, using editor fallback: Error: Context fail
    at [90m/app/[39mtests/features/agent/hooks/useAgentOrchestrator.test.ts:404:57
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstderr[2m | tests/features/agent/hooks/useAgentOrchestrator.test.ts[2m > [22m[2museAgentOrchestrator[2m > [22m[2mhandles undefined lore characters gracefully
[22m[39mWarning: Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render.

[90mstderr[2m | tests/features/agent/hooks/useAgentOrchestrator.test.ts[2m > [22m[2museAgentOrchestrator[2m > [22m[2mhandles undefined lore characters gracefully
[22m[39mWarning: Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render.
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:307:5)

[90mstderr[2m | tests/features/agent/hooks/useAgentOrchestrator.test.ts[2m > [22m[2museAgentOrchestrator[2m > [22m[2mhandles undefined lore characters gracefully
[22m[39mWarning: Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render.
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:307:5)

[90mstderr[2m | tests/features/agent/hooks/useAgentOrchestrator.test.ts[2m > [22m[2museAgentOrchestrator[2m > [22m[2mhandles activeChapter fallback in error path when chapter not found
[22m[39m[AgentOrchestrator] Smart context unavailable, using editor fallback: Error: Context fail
    at [90m/app/[39mtests/features/agent/hooks/useAgentOrchestrator.test.ts:587:57
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstderr[2m | tests/features/agent/hooks/useAgentOrchestrator.test.ts[2m > [22m[2museAgentOrchestrator[2m > [22m[2mhandles missing content in activeChapter during fallback
[22m[39m[AgentOrchestrator] Smart context unavailable, using editor fallback: Error: Context fail
    at [90m/app/[39mtests/features/agent/hooks/useAgentOrchestrator.test.ts:608:57
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstderr[2m | tests/features/agent/hooks/useAgentOrchestrator.test.ts[2m > [22m[2museAgentOrchestrator[2m > [22m[2mdoes not nullify abortController if a new request started
[22m[39mWarning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:307:5)
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:307:5)
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:307:5)
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:307:5)

 [32mâœ“[39m tests/features/agent/hooks/useAgentOrchestrator.test.ts [2m([22m[2m28 tests[22m[2m)[22m[33m 1921[2mms[22m[39m
[90mstderr[2m | tests/services/core/AgentController.test.ts[2m > [22m[2mDefaultAgentController[2m > [22m[2msends a simple message without tool calls
[22m[39m[AgentController] Falling back to editor-only context: Cannot read properties of undefined (reading 'context')

[90mstderr[2m | tests/services/core/AgentController.test.ts[2m > [22m[2mDefaultAgentController[2m > [22m[2mruns tool loop when model returns functionCalls
[22m[39m[AgentController] Falling back to editor-only context: Cannot read properties of undefined (reading 'context')

[90mstderr[2m | tests/services/core/AgentController.test.ts[2m > [22m[2mDefaultAgentController[2m > [22m[2mskips bedside-note suggestion when update tool already ran
[22m[39m[AgentController] Falling back to editor-only context: Cannot read properties of undefined (reading 'context')

[90mstderr[2m | tests/services/core/AgentController.test.ts[2m > [22m[2mDefaultAgentController[2m > [22m[2mdoes not add reflection text for non-significant tools
[22m[39m[AgentController] Falling back to editor-only context: Cannot read properties of undefined (reading 'context')

[90mstderr[2m | tests/services/core/AgentController.test.ts[2m > [22m[2mDefaultAgentController[2m > [22m[2mhandles model errors by updating state and emitting a friendly error message
[22m[39m[AgentController] Falling back to editor-only context: Cannot read properties of undefined (reading 'context')

[90mstderr[2m | tests/services/core/AgentController.test.ts[2m > [22m[2mDefaultAgentController[2m > [22m[2mreinitializes chat on resetSession and clears chat on dispose
[22m[39m[AgentController] Falling back to editor-only context: Cannot read properties of undefined (reading 'context')

[90mstderr[2m | tests/services/core/AgentController.test.ts[2m > [22m[2mDefaultAgentController[2m > [22m[2mreinitializes chat on resetSession and clears chat on dispose
[22m[39m[AgentController] Falling back to editor-only context: Cannot read properties of undefined (reading 'context')

[90mstderr[2m | tests/services/core/AgentController.test.ts[2m > [22m[2mDefaultAgentController[2m > [22m[2mbuilds smart context when available and falls back on failure
[22m[39m[AgentController] Falling back to editor-only context: ctx failed

[90mstderr[2m | tests/services/core/AgentController.test.ts[2m > [22m[2mDefaultAgentController[2m > [22m[2mtreats AbortError as a clean cancellation without error state
[22m[39m[AgentController] Falling back to editor-only context: Cannot read properties of undefined (reading 'context')

[90mstderr[2m | tests/services/core/AgentController.test.ts[2m > [22m[2mDefaultAgentController[2m > [22m[2mpushes fallback functionResponse on tool execution error
[22m[39m[AgentController] Falling back to editor-only context: Cannot read properties of undefined (reading 'context')

[90mstderr[2m | tests/services/core/AgentController.test.ts[2m > [22m[2mDefaultAgentController[2m > [22m[2mdoes nothing when input text is empty or state is busy
[22m[39m[AgentController] Falling back to editor-only context: Cannot read properties of undefined (reading 'context')

[90mstderr[2m | tests/services/core/AgentController.test.ts[2m > [22m[2mDefaultAgentController[2m > [22m[2mhandles initialization failure gracefully
[22m[39mFailed to initialize chat session: Error: Init failed
    at [90m/app/[39mtests/services/core/AgentController.test.ts:607:60
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstderr[2m | tests/services/core/AgentController.test.ts[2m > [22m[2mDefaultAgentController[2m > [22m[2mstops processing final response when request is aborted mid-loop
[22m[39m[AgentController] Falling back to editor-only context: Cannot read properties of undefined (reading 'context')

 [32mâœ“[39m tests/services/core/AgentController.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 56[2mms[22m[39m
Error: Uncaught [Error: useEditor must be used within an EditorProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useEditor must be used within an EditorProvider
    at Module.useEditor (/app/features/core/context/EditorContext.tsx:367:11)
    at /app/tests/context/EditorContext.test.tsx:232:26
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
Error: Uncaught [Error: useEditor must be used within an EditorProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useEditor must be used within an EditorProvider
    at Module.useEditor (/app/features/core/context/EditorContext.tsx:367:11)
    at /app/tests/context/EditorContext.test.tsx:232:26
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
Error: Uncaught [Error: useEditorState must be used within an EditorProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useEditorState must be used within an EditorProvider
    at Module.useEditorState (/app/features/core/context/EditorContext.tsx:375:11)
    at /app/tests/context/EditorContext.test.tsx:251:26
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
Error: Uncaught [Error: useEditorState must be used within an EditorProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useEditorState must be used within an EditorProvider
    at Module.useEditorState (/app/features/core/context/EditorContext.tsx:375:11)
    at /app/tests/context/EditorContext.test.tsx:251:26
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
Error: Uncaught [Error: useEditorActions must be used within an EditorProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useEditorActions must be used within an EditorProvider
    at Module.useEditorActions (/app/features/core/context/EditorContext.tsx:383:11)
    at /app/tests/context/EditorContext.test.tsx:261:26
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
Error: Uncaught [Error: useEditorActions must be used within an EditorProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useEditorActions must be used within an EditorProvider
    at Module.useEditorActions (/app/features/core/context/EditorContext.tsx:383:11)
    at /app/tests/context/EditorContext.test.tsx:261:26
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
 [32mâœ“[39m tests/context/EditorContext.test.tsx [2m([22m[2m37 tests[22m[2m)[22m[32m 209[2mms[22m[39m
[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mexposes state and actions from provider
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mexposes state and actions from provider
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mdelegates jump and edit actions to command implementations
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mdelegates jump and edit actions to command implementations
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2museAppBrainState hook[2m > [22m[2mreturns full state without selector
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2museAppBrainState hook[2m > [22m[2mreturns full state without selector
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2museAppBrainState hook[2m > [22m[2mreturns selected state with selector
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2museAppBrainState hook[2m > [22m[2mreturns selected state with selector
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2museAppBrainActions hook[2m > [22m[2mreturns actions object
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2museAppBrainActions hook[2m > [22m[2mreturns actions object
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2museAppBrainContext hook[2m > [22m[2mreturns context builders
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2museAppBrainContext hook[2m > [22m[2mreturns context builders
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2manalysis actions[2m > [22m[2mdelegates getCritiqueForSelection to command
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2manalysis actions[2m > [22m[2mdelegates getCritiqueForSelection to command
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2manalysis actions[2m > [22m[2mdelegates runAnalysis to command
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2manalysis actions[2m > [22m[2mdelegates runAnalysis to command
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mUI actions[2m > [22m[2mdelegates switchPanel to command
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mUI actions[2m > [22m[2mdelegates switchPanel to command
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mUI actions[2m > [22m[2mdelegates toggleZenMode to command
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mUI actions[2m > [22m[2mdelegates toggleZenMode to command
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mUI actions[2m > [22m[2mdelegates highlightText to command
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mUI actions[2m > [22m[2mdelegates highlightText to command
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mUI actions[2m > [22m[2mscrollToPosition calls editor method
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mUI actions[2m > [22m[2mscrollToPosition calls editor method
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mknowledge actions[2m > [22m[2mdelegates queryLore to command
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mknowledge actions[2m > [22m[2mdelegates queryLore to command
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mknowledge actions[2m > [22m[2mdelegates getCharacterInfo to command
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mknowledge actions[2m > [22m[2mdelegates getCharacterInfo to command
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mknowledge actions[2m > [22m[2mreturns timeline events for nearby range
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mknowledge actions[2m > [22m[2mreturns timeline events for nearby range
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mknowledge actions[2m > [22m[2mreturns timeline events for before range
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mknowledge actions[2m > [22m[2mreturns timeline events for before range
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mknowledge actions[2m > [22m[2mreturns timeline events for after range
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mknowledge actions[2m > [22m[2mreturns timeline events for after range
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mgeneration actions[2m > [22m[2mdelegates rewriteSelection to command
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mgeneration actions[2m > [22m[2mdelegates rewriteSelection to command
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mgeneration actions[2m > [22m[2mdelegates continueWriting to command
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mgeneration actions[2m > [22m[2mdelegates continueWriting to command
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mundo/redo actions[2m > [22m[2mcalls editor undo and returns message
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mundo/redo actions[2m > [22m[2mcalls editor undo and returns message
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mundo/redo actions[2m > [22m[2mcalls editor redo and returns message for failure
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mundo/redo actions[2m > [22m[2mcalls editor redo and returns message for failure
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mundo/redo actions[2m > [22m[2mreturns message when undo has nothing to undo
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mundo/redo actions[2m > [22m[2mreturns message when undo has nothing to undo
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mundo/redo actions[2m > [22m[2mreturns message when redo succeeds
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mundo/redo actions[2m > [22m[2mreturns message when redo succeeds
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone state[2m > [22m[2mupdates microphone state with setMicrophoneState
[22m[39m[FeedbackTracker] Started

 [32mâœ“[39m tests/services/memory/factExtractor.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 32[2mms[22m[39m
[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone state[2m > [22m[2mupdates microphone state with setMicrophoneState
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mevent subscriptions[2m > [22m[2mexposes subscribe and subscribeAll functions
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mevent subscriptions[2m > [22m[2mexposes subscribe and subscribeAll functions
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone and timeline edge cases[2m > [22m[2mmerges microphone state updates without resetting existing fields
[22m[39m[FeedbackTracker] Started

[90mstderr[2m | tests/services/memory/consolidation.test.ts[2m > [22m[2mMemory Consolidation[2m > [22m[2mreinforceMemory[2m > [22m[2mhandles database errors gracefully
[22m[39m[consolidation] Failed to reinforce memory m1: Error: DB Fail
    at [90m/app/[39mtests/services/memory/consolidation.test.ts:445:52
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstdout[2m | tests/services/memory/consolidation.test.ts[2m > [22m[2mMemory Consolidation[2m > [22m[2mrunConsolidation[2m > [22m[2mruns full consolidation pipeline
[22m[39m[consolidation] Starting for project test-project...

[90mstdout[2m | tests/services/memory/consolidation.test.ts[2m > [22m[2mMemory Consolidation[2m > [22m[2mrunConsolidation[2m > [22m[2mruns full consolidation pipeline
[22m[39m[consolidation] Complete: 0 decayed, 0 merged, 0 archived (0ms, 0 errors)

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone and timeline edge cases[2m > [22m[2mmerges microphone state updates without resetting existing fields
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone and timeline edge cases[2m > [22m[2mreturns message when no timeline events are available
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone and timeline edge cases[2m > [22m[2mreturns message when no timeline events are available
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone and timeline edge cases[2m > [22m[2mreturns message when no intelligence timeline data is available
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone and timeline edge cases[2m > [22m[2mreturns message when no intelligence timeline data is available
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone and timeline edge cases[2m > [22m[2muses default chapterId when activeChapterId is falsy
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone and timeline edge cases[2m > [22m[2muses default chapterId when activeChapterId is falsy
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone and timeline edge cases[2m > [22m[2mfalls back to SidebarTab.ANALYSIS and storyboards when layout state is missing
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone and timeline edge cases[2m > [22m[2mfalls back to SidebarTab.ANALYSIS and storyboards when layout state is missing
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone and timeline edge cases[2m > [22m[2minvokes command callbacks that coalesce to activeTab when panel is undefined
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone and timeline edge cases[2m > [22m[2minvokes command callbacks that coalesce to activeTab when panel is undefined
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone and timeline edge cases[2m > [22m[2mcovers generation fallbacks when providers return empty results or throw
[22m[39m[FeedbackTracker] Started

 [32mâœ“[39m tests/services/memory/consolidation.test.ts [2m([22m[2m28 tests[22m[2m)[22m[32m 52[2mms[22m[39m
[90mstderr[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone and timeline edge cases[2m > [22m[2mcovers generation fallbacks when providers return empty results or throw
[22m[39m[AppBrainContext] Continuation failed Error: nope
    at [90m/app/[39mtests/features/core/AppBrainContext.test.tsx:677:67
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/features/core/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mmicrophone and timeline edge cases[2m > [22m[2mcovers generation fallbacks when providers return empty results or throw
[22m[39m[FeedbackTracker] Stopped

 [32mâœ“[39m tests/features/core/AppBrainContext.test.tsx [2m([22m[2m32 tests[22m[2m)[22m[33m 540[2mms[22m[39m
[90mstderr[2m | tests/services/intelligence/chunkManager.test.ts[2m > [22m[2mChunkManager processing and persistence flows[2m > [22m[2mretries errored chunks by scheduling background reprocessing
[22m[39m[ChunkManager] Error processing chapter-parent-scene-0: Could not retrieve chunk text (invalid range or missing chapter)

[90mstderr[2m | tests/services/intelligence/chunkManager.test.ts[2m > [22m[2mChunkManager processing and persistence flows[2m > [22m[2mretries errored chunks by scheduling background reprocessing
[22m[39m[ChunkManager] Error processing chapter-ch3-scene-1: Could not retrieve chunk text (invalid range or missing chapter)

[90mstderr[2m | tests/services/intelligence/chunkManager.test.ts[2m > [22m[2mChunkManager processing and persistence flows[2m > [22m[2mretries errored chunks by scheduling background reprocessing
[22m[39m[ChunkManager] Error processing chapter-parent-scene-1: Could not retrieve chunk text (invalid range or missing chapter)

[90mstderr[2m | tests/services/intelligence/chunkManager.test.ts[2m > [22m[2mChunkManager processing and persistence flows[2m > [22m[2mretries errored chunks by scheduling background reprocessing
[22m[39m[ChunkManager] Error processing chapter-ch1: Could not retrieve chunk text (invalid range or missing chapter)

[90mstderr[2m | tests/services/intelligence/chunkManager.test.ts[2m > [22m[2mChunkManager processing and persistence flows[2m > [22m[2mretries errored chunks by scheduling background reprocessing
[22m[39m[ChunkManager] Error processing chapter-parent: Could not retrieve chunk text (invalid range or missing chapter)

[90mstderr[2m | tests/services/intelligence/chunkManager.test.ts[2m > [22m[2mChunkManager processing and persistence flows[2m > [22m[2mretries errored chunks by scheduling background reprocessing
[22m[39m[ChunkManager] Error processing chapter-ch2: Could not retrieve chunk text (invalid range or missing chapter)

[90mstderr[2m | tests/services/intelligence/chunkManager.test.ts[2m > [22m[2mChunkManager processing and persistence flows[2m > [22m[2memits errors when chunk text cannot be loaded
[22m[39m[ChunkManager] Error processing chapter-missing-text-scene-0: Could not retrieve chunk text (invalid range or missing chapter)

[90mstderr[2m | tests/services/intelligence/chunkManager.test.ts[2m > [22m[2mChunkManager processing and persistence flows[2m > [22m[2memits errors when chunk text cannot be loaded
[22m[39m[ChunkManager] Error processing chapter-missing-text: Could not retrieve chunk text (invalid range or missing chapter)

[90mstderr[2m | tests/services/intelligence/chunkManager.test.ts[2m > [22m[2mChunkManager worker + error branches[2m > [22m[2mreports errors when chapter text is missing during reprocess
[22m[39m[ChunkManager] Error processing chapter-c1: Could not retrieve chunk text (invalid range or missing chapter)

[90mstderr[2m | tests/services/intelligence/chunkManager.test.ts[2m > [22m[2mChunkManager worker + error branches[2m > [22m[2msurfaces worker failures as chunk processing errors
[22m[39m[ChunkManager] Error processing chapter-c1-scene-0: worker-fail

[90mstderr[2m | tests/services/intelligence/chunkManager.test.ts[2m > [22m[2mChunkManager worker + error branches[2m > [22m[2muses a generic message when a non-Error is thrown during chunk processing
[22m[39m[ChunkManager] Error processing chapter-c1: Unknown error

 [32mâœ“[39m tests/services/intelligence/chunkManager.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 68[2mms[22m[39m
[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2minitialize[2m > [22m[2mcreates workers based on pool size
[22m[39m[WorkerPool] Initialized with 2 workers

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2minitialize[2m > [22m[2mdoes not reinitialize if already initialized
[22m[39m[WorkerPool] Initialized with 2 workers

[90mstderr[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2minitialize[2m > [22m[2mfalls back gracefully when Worker is undefined
[22m[39m[WorkerPool] Web Workers not supported, falling back to main thread

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2msubmitJob[2m > [22m[2mdispatches job to idle worker immediately
[22m[39m[WorkerPool] Initialized with 2 workers

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2msubmitJob[2m > [22m[2mqueues job when all workers are busy
[22m[39m[WorkerPool] Initialized with 1 workers

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2msubmitJob[2m > [22m[2msorts queue by priority
[22m[39m[WorkerPool] Initialized with 1 workers

[90mstderr[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mprocessChapters[2m > [22m[2mprocesses chapters sequentially when workers not supported
[22m[39m[WorkerPool] Web Workers not supported, falling back to main thread

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mprocessChapters[2m > [22m[2mprocesses chapters in parallel when workers available
[22m[39m[WorkerPool] Initialized with 2 workers

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mprocessChapters[2m > [22m[2mskips storing results when worker callbacks report failure
[22m[39m[WorkerPool] Initialized with 1 workers

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mcancelJob[2m > [22m[2mremoves job from queue and returns true
[22m[39m[WorkerPool] Initialized with 1 workers

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mcancelJob[2m > [22m[2mreturns false for non-queued job
[22m[39m[WorkerPool] Initialized with 2 workers

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mcancelChapterJobs[2m > [22m[2mcancels all jobs for a specific chapter
[22m[39m[WorkerPool] Initialized with 1 workers

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mgetStats[2m > [22m[2mreturns pool statistics
[22m[39m[WorkerPool] Initialized with 2 workers

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mgetStats[2m > [22m[2mreflects busy workers
[22m[39m[WorkerPool] Initialized with 2 workers

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mgetStats[2m > [22m[2mcalculates average processing time
[22m[39m[WorkerPool] Initialized with 1 workers

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mterminate[2m > [22m[2mterminates all workers and clears state
[22m[39m[WorkerPool] Initialized with 2 workers

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mworker message handling[2m > [22m[2mcalls callback on successful result
[22m[39m[WorkerPool] Initialized with 1 workers

 [32mâœ“[39m tests/services/appBrain/contextBuilder.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 55[2mms[22m[39m
[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mworker message handling[2m > [22m[2mprocesses next job in queue after completion
[22m[39m[WorkerPool] Initialized with 1 workers

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mworker message handling[2m > [22m[2mhandles worker error messages and dispatches queued jobs
[22m[39m[WorkerPool] Initialized with 1 workers

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mworker message handling[2m > [22m[2mpropagates worker onerror events and schedules the next job
[22m[39m[WorkerPool] Initialized with 1 workers

[90mstderr[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mworker message handling[2m > [22m[2mpropagates worker onerror events and schedules the next job
[22m[39m[WorkerPool] Worker worker_0 error: { message: [32m'kaboom'[39m }

[90mstderr[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mworker message handling[2m > [22m[2minvokes error callbacks when a worker throws
[22m[39m[WorkerPool] Worker worker_1 error: { message: [32m'fail'[39m }

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mworker message handling[2m > [22m[2mfalls back when callbacks are missing but a queue exists
[22m[39m[WorkerPool] Initialized with 1 workers

[90mstderr[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mIntelligenceWorkerPool[2m > [22m[2mworker message handling[2m > [22m[2mhandles worker error when callback is missing (job exists but callback deleted)
[22m[39m[WorkerPool] Worker worker_1 error: { message: [32m'fail'[39m }

[90mstdout[2m | tests/services/intelligence/workerPool.test.ts[2m > [22m[2mSingleton helpers[2m > [22m[2minitializeWorkerPool[2m > [22m[2minitializes the singleton pool
[22m[39m[WorkerPool] Initialized with 3 workers

 [32mâœ“[39m tests/services/intelligence/workerPool.test.ts [2m([22m[2m34 tests[22m[2m)[22m[32m 241[2mms[22m[39m
 [32mâœ“[39m tests/types/intelligence.test.ts [2m([22m[2m45 tests[22m[2m)[22m[32m 28[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/realtimeTriggers.test.ts [2m([22m[2m28 tests[22m[2m)[22m[33m 1006[2mms[22m[39m
       [33m[2mâœ“[22m[39m cancel clears pending debounced checks [33m 602[2mms[22m[39m
 [32mâœ“[39m tests/components/LoreManager.test.tsx [2m([22m[2m28 tests[22m[2m)[22m[33m 1400[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/proactive.test.ts [2m([22m[2m28 tests[22m[2m)[22m[32m 34[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/index.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 121[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/styleAnalyzer.test.ts [2m([22m[2m38 tests[22m[2m)[22m[32m 77[2mms[22m[39m
 [32mâœ“[39m tests/services/appBrain/eventBus.test.ts [2m([22m[2m45 tests[22m[2m)[22m[32m 133[2mms[22m[39m
Error: Uncaught [Error: useAnalysis must be used within AnalysisProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useAnalysis must be used within AnalysisProvider
    at Module.useAnalysis (/app/features/analysis/context/AnalysisContext.tsx:359:23)
    at /app/tests/features/analysis/context/AnalysisContext.test.tsx:71:35
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
Error: Uncaught [Error: useAnalysis must be used within AnalysisProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useAnalysis must be used within AnalysisProvider
    at Module.useAnalysis (/app/features/analysis/context/AnalysisContext.tsx:359:23)
    at /app/tests/features/analysis/context/AnalysisContext.test.tsx:71:35
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
[90mstderr[2m | tests/features/analysis/context/AnalysisContext.test.tsx[2m > [22m[2mAnalysisContext[2m > [22m[2mFull Analysis[2m > [22m[2maborts analysis correctly
[22m[39m[AnalysisContext] Full analysis failed: DOMException {}
Warning: An update to AnalysisProvider inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at AnalysisProvider (/app/features/analysis/context/AnalysisContext.tsx:20:29)
    at wrapper (/app/tests/features/analysis/context/AnalysisContext.test.tsx:291:26)

 [32mâœ“[39m tests/components/StoryBoard.test.tsx [2m([22m[2m24 tests[22m[2m)[22m[33m 742[2mms[22m[39m
[90mstderr[2m | tests/features/analysis/context/AnalysisContext.test.tsx[2m > [22m[2mAnalysisContext[2m > [22m[2mFull Analysis[2m > [22m[2mprevents reusing aborted controller signal
[22m[39m[AnalysisContext] Full analysis failed: DOMException {}
Warning: An update to AnalysisProvider inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at AnalysisProvider (/app/features/analysis/context/AnalysisContext.tsx:20:29)
    at wrapper (/app/tests/features/analysis/context/AnalysisContext.test.tsx:349:26)

 [32mâœ“[39m tests/features/analysis/context/AnalysisContext.test.tsx [2m([22m[2m19 tests[22m[2m)[22m[32m 151[2mms[22m[39m
 [32mâœ“[39m tests/components/ToolsPanel.test.tsx [2m([22m[2m31 tests[22m[2m)[22m[33m 454[2mms[22m[39m
[90mstdout[2m | tests/features/shared/hooks/useSmartnessPipeline.test.ts[2m > [22m[2museSmartnessPipeline[2m > [22m[2manalyzeNow[2m > [22m[2msets isAnalyzing during analysis
[22m[39m[SmartnessPipeline] Bridge found 0 conflicts, created 0 memories (100ms)

[90mstdout[2m | tests/features/shared/hooks/useSmartnessPipeline.test.ts[2m > [22m[2museSmartnessPipeline[2m > [22m[2manalyzeNow[2m > [22m[2madds conflicts from analysis result
[22m[39m[SmartnessPipeline] Bridge found 1 conflicts, created 0 memories (50ms)

[90mstdout[2m | tests/features/shared/hooks/useSmartnessPipeline.test.ts[2m > [22m[2museSmartnessPipeline[2m > [22m[2manalyzeNow[2m > [22m[2mavoids duplicate conflicts
[22m[39m[SmartnessPipeline] Bridge found 1 conflicts, created 0 memories (50ms)

[90mstdout[2m | tests/features/shared/hooks/useSmartnessPipeline.test.ts[2m > [22m[2museSmartnessPipeline[2m > [22m[2manalyzeNow[2m > [22m[2mavoids duplicate conflicts
[22m[39m[SmartnessPipeline] Bridge found 1 conflicts, created 0 memories (50ms)

[90mstdout[2m | tests/features/shared/hooks/useSmartnessPipeline.test.ts[2m > [22m[2museSmartnessPipeline[2m > [22m[2manalyzeNow[2m > [22m[2mlimits conflicts to 20
[22m[39m[SmartnessPipeline] Bridge found 25 conflicts, created 0 memories (50ms)

 [32mâœ“[39m tests/services/memory/index.test.ts [2m([22m[2m34 tests[22m[2m)[22m[32m 30[2mms[22m[39m
[90mstdout[2m | tests/features/shared/hooks/useSmartnessPipeline.test.ts[2m > [22m[2museSmartnessPipeline[2m > [22m[2mmanagement actions[2m > [22m[2mclearConflicts empties conflicts array
[22m[39m[SmartnessPipeline] Bridge found 1 conflicts, created 0 memories (10ms)

 [32mâœ“[39m tests/features/shared/hooks/useSmartnessPipeline.test.ts [2m([22m[2m23 tests[22m[2m)[22m[32m 102[2mms[22m[39m
 [32mâœ“[39m tests/utils/textLocator.test.ts [2m([22m[2m42 tests[22m[2m)[22m[32m 40[2mms[22m[39m
 [32mâœ“[39m tests/services/gemini/serializers.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 25[2mms[22m[39m
[90mstderr[2m | tests/services/gemini/agent.test.ts[2m > [22m[2mrewriteText[2m > [22m[2mfalls back to empty variations when response does not match expected schema
[22m[39m[Telemetry] Error captured Error: Response does not match expected schema
    at safeParseJsonWithValidation [90m(/app/[39mservices/gemini/resilientParser.ts:236:19[90m)[39m
    at Module.rewriteText [90m(/app/[39mservices/gemini/direct-actions.ts:58:25[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/services/gemini/agent.test.ts:126:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 { rawResponse: [90mundefined[39m }
[rewriteText] Parse failed: Response does not match expected schema

[90mstderr[2m | tests/services/gemini/agent.test.ts[2m > [22m[2mrewriteText[2m > [22m[2mhandles malformed JSON response gracefully
[22m[39m[Telemetry] Error captured Error: Failed to parse JSON after sanitization
    at notifyFailure [90m(/app/[39mservices/gemini/resilientParser.ts:159:21[90m)[39m
    at safeParseJson [90m(/app/[39mservices/gemini/resilientParser.ts:198:3[90m)[39m
    at safeParseJsonWithValidation [90m(/app/[39mservices/gemini/resilientParser.ts:216:18[90m)[39m
    at Module.rewriteText [90m(/app/[39mservices/gemini/direct-actions.ts:58:25[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/services/gemini/agent.test.ts:137:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
  error: [32m'Failed to parse JSON after sanitization'[39m,
  rawResponse: [32m'not json'[39m,
  snippet: [32m'not json'[39m,
  sanitized: [33mfalse[39m
}
[rewriteText] Parse failed: Failed to parse JSON after sanitization. Raw: not json...

[90mstderr[2m | tests/services/gemini/agent.test.ts[2m > [22m[2mrewriteText[2m > [22m[2mhandles empty string response gracefully
[22m[39m[Telemetry] Error captured Error: Empty response received
    at notifyFailure [90m(/app/[39mservices/gemini/resilientParser.ts:159:21[90m)[39m
    at safeParseJson [90m(/app/[39mservices/gemini/resilientParser.ts:164:5[90m)[39m
    at safeParseJsonWithValidation [90m(/app/[39mservices/gemini/resilientParser.ts:216:18[90m)[39m
    at Module.rewriteText [90m(/app/[39mservices/gemini/direct-actions.ts:58:25[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/services/gemini/agent.test.ts:148:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
  error: [32m'Empty response received'[39m,
  rawResponse: [32m''[39m,
  snippet: [90mundefined[39m,
  sanitized: [33mfalse[39m
}
[rewriteText] Parse failed: Empty response received

[90mstderr[2m | tests/services/gemini/agent.test.ts[2m > [22m[2mrewriteText[2m > [22m[2mhandles API errors gracefully
[22m[39m[Telemetry] Error captured UnknownAIError: API Error
    at normalizeAIError [90m(/app/[39mservices/gemini/errors.ts:64:18[90m)[39m
    at Module.rewriteText [90m(/app/[39mservices/gemini/direct-actions.ts:78:24[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/services/gemini/agent.test.ts:157:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
  isRetryable: [33mfalse[39m,
  [cause]: Error: API Error
      at [90m/app/[39mtests/services/gemini/agent.test.ts:155:53
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
      at new Promise (<anonymous>)
      at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
      at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
      at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
      at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m
} {
  mode: [32m'Edit Mode'[39m,
  tone: [90mundefined[39m,
  textLength: [33m9[39m,
  hasSetting: [33mfalse[39m
}
[rewriteText] Failed UnknownAIError: API Error
    at normalizeAIError [90m(/app/[39mservices/gemini/errors.ts:64:18[90m)[39m
    at Module.rewriteText [90m(/app/[39mservices/gemini/direct-actions.ts:78:24[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/services/gemini/agent.test.ts:157:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
  isRetryable: [33mfalse[39m,
  [cause]: Error: API Error
      at [90m/app/[39mtests/services/gemini/agent.test.ts:155:53
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
      at new Promise (<anonymous>)
      at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
      at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
      at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
      at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m
}

[90mstderr[2m | tests/services/gemini/agent.test.ts[2m > [22m[2mrewriteText[2m > [22m[2mhandles rate limit errors gracefully
[22m[39m[Telemetry] Error captured RateLimitError: Rate limit exceeded
    at normalizeAIError [90m(/app/[39mservices/gemini/errors.ts:62:18[90m)[39m
    at Module.rewriteText [90m(/app/[39mservices/gemini/direct-actions.ts:78:24[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/services/gemini/agent.test.ts:166:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
  isRetryable: [33mtrue[39m,
  [cause]: Error: Rate limit exceeded
      at Module.createRateLimitError [90m(/app/[39mtests/mocks/geminiClient.ts:142:22[90m)[39m
      at [90m/app/[39mtests/services/gemini/agent.test.ts:164:53
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
      at new Promise (<anonymous>)
      at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
      at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
      at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m {
    status: [33m429[39m
  }
} {
  mode: [32m'Edit Mode'[39m,
  tone: [90mundefined[39m,
  textLength: [33m9[39m,
  hasSetting: [33mfalse[39m
}
[rewriteText] Failed RateLimitError: Rate limit exceeded
    at normalizeAIError [90m(/app/[39mservices/gemini/errors.ts:62:18[90m)[39m
    at Module.rewriteText [90m(/app/[39mservices/gemini/direct-actions.ts:78:24[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/services/gemini/agent.test.ts:166:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
  isRetryable: [33mtrue[39m,
  [cause]: Error: Rate limit exceeded
      at Module.createRateLimitError [90m(/app/[39mtests/mocks/geminiClient.ts:142:22[90m)[39m
      at [90m/app/[39mtests/services/gemini/agent.test.ts:164:53
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
      at new Promise (<anonymous>)
      at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
      at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
      at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m {
    status: [33m429[39m
  }
}

[90mstderr[2m | tests/services/gemini/agent.test.ts[2m > [22m[2mrewriteText[2m > [22m[2mhandles context length exceeded errors gracefully
[22m[39m[Telemetry] Error captured UnknownAIError: Context length exceeded
    at normalizeAIError [90m(/app/[39mservices/gemini/errors.ts:64:18[90m)[39m
    at Module.rewriteText [90m(/app/[39mservices/gemini/direct-actions.ts:78:24[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/services/gemini/agent.test.ts:175:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
  isRetryable: [33mfalse[39m,
  [cause]: Error: Context length exceeded
      at Module.createContextLengthError [90m(/app/[39mtests/mocks/geminiClient.ts:148:22[90m)[39m
      at [90m/app/[39mtests/services/gemini/agent.test.ts:173:53
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
      at new Promise (<anonymous>)
      at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
      at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
      at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m {
    status: [33m413[39m
  }
} {
  mode: [32m'Edit Mode'[39m,
  tone: [90mundefined[39m,
  textLength: [33m9[39m,
  hasSetting: [33mfalse[39m
}
[rewriteText] Failed UnknownAIError: Context length exceeded
    at normalizeAIError [90m(/app/[39mservices/gemini/errors.ts:64:18[90m)[39m
    at Module.rewriteText [90m(/app/[39mservices/gemini/direct-actions.ts:78:24[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/services/gemini/agent.test.ts:175:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
  isRetryable: [33mfalse[39m,
  [cause]: Error: Context length exceeded
      at Module.createContextLengthError [90m(/app/[39mtests/mocks/geminiClient.ts:148:22[90m)[39m
      at [90m/app/[39mtests/services/gemini/agent.test.ts:173:53
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
      at new Promise (<anonymous>)
      at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
      at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
      at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m {
    status: [33m413[39m
  }
}

[90mstderr[2m | tests/services/gemini/agent.test.ts[2m > [22m[2mgenerateContinuation[2m > [22m[2mthrows an AIError when no continuation text is returned
[22m[39m[Telemetry] Error captured AIError: No continuation was returned from the model.
    at Module.generateContinuation [90m(/app/[39mservices/gemini/direct-actions.ts:112:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m {
  isRetryable: [33mfalse[39m,
  [cause]: [90mundefined[39m
} { contextLength: [33m24[39m }
[generateContinuation] Failed to generate continuation AIError: No continuation was returned from the model.
    at Module.generateContinuation [90m(/app/[39mservices/gemini/direct-actions.ts:112:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m {
  isRetryable: [33mfalse[39m,
  [cause]: [90mundefined[39m
}

[90mstderr[2m | tests/services/gemini/agent.test.ts[2m > [22m[2mQuillAgent[2m > [22m[2mnormalizes rate limit errors during initialize
[22m[39m[Telemetry] Error captured RateLimitError: Rate limit exceeded
    at normalizeAIError [90m(/app/[39mservices/gemini/errors.ts:62:18[90m)[39m
    at QuillAgent.initialize [90m(/app/[39mservices/gemini/factory.ts:185:13[90m)[39m
    at [90m/app/[39mtests/services/gemini/agent.test.ts:472:24
[90m    ... 3 lines matching cause stack trace ...[39m
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m {
  isRetryable: [33mtrue[39m,
  [cause]: Error: Rate limit exceeded
      at Module.createRateLimitError [90m(/app/[39mtests/mocks/geminiClient.ts:142:22[90m)[39m
      at Object.<anonymous> [90m(/app/[39mtests/services/gemini/agent.test.ts:467:13[90m)[39m
      at Object.Mock [as create] [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
      at createAgentSession [90m(/app/[39mservices/gemini/factory.ts:136:19[90m)[39m
      at QuillAgent.initialize [90m(/app/[39mservices/gemini/factory.ts:183:28[90m)[39m
      at [90m/app/[39mtests/services/gemini/agent.test.ts:472:24
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
      at new Promise (<anonymous>) {
    status: [33m429[39m
  }
} { phase: [32m'test'[39m, source: [32m'QuillAgent'[39m }

[90mstderr[2m | tests/services/gemini/agent.test.ts[2m > [22m[2mQuillAgent[2m > [22m[2mnormalizes rate limit errors during initialize
[22m[39m[Telemetry] Error captured RateLimitError: Rate limit exceeded
    at normalizeAIError [90m(/app/[39mservices/gemini/errors.ts:62:18[90m)[39m
    at QuillAgent.initialize [90m(/app/[39mservices/gemini/factory.ts:185:13[90m)[39m
    at [90m/app/[39mtests/services/gemini/agent.test.ts:474:19
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
  isRetryable: [33mtrue[39m,
  [cause]: Error: Rate limit exceeded
      at Module.createRateLimitError [90m(/app/[39mtests/mocks/geminiClient.ts:142:22[90m)[39m
      at Object.<anonymous> [90m(/app/[39mtests/services/gemini/agent.test.ts:467:13[90m)[39m
      at Object.Mock [as create] [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
      at createAgentSession [90m(/app/[39mservices/gemini/factory.ts:136:19[90m)[39m
      at QuillAgent.initialize [90m(/app/[39mservices/gemini/factory.ts:183:28[90m)[39m
      at [90m/app/[39mtests/services/gemini/agent.test.ts:474:19
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
    status: [33m429[39m
  }
} { phase: [32m'test'[39m, source: [32m'QuillAgent'[39m }

[90mstderr[2m | tests/services/gemini/agent.test.ts[2m > [22m[2mQuillAgent[2m > [22m[2mnormalizes context length exceeded errors during initialize
[22m[39m[Telemetry] Error captured UnknownAIError: Context length exceeded
    at normalizeAIError [90m(/app/[39mservices/gemini/errors.ts:64:18[90m)[39m
    at QuillAgent.initialize [90m(/app/[39mservices/gemini/factory.ts:185:13[90m)[39m
    at [90m/app/[39mtests/services/gemini/agent.test.ts:488:24
[90m    ... 3 lines matching cause stack trace ...[39m
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m {
  isRetryable: [33mfalse[39m,
  [cause]: Error: Context length exceeded
      at Module.createContextLengthError [90m(/app/[39mtests/mocks/geminiClient.ts:148:22[90m)[39m
      at Object.<anonymous> [90m(/app/[39mtests/services/gemini/agent.test.ts:483:13[90m)[39m
      at Object.Mock [as create] [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
      at createAgentSession [90m(/app/[39mservices/gemini/factory.ts:136:19[90m)[39m
      at QuillAgent.initialize [90m(/app/[39mservices/gemini/factory.ts:183:28[90m)[39m
      at [90m/app/[39mtests/services/gemini/agent.test.ts:488:24
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
      at new Promise (<anonymous>) {
    status: [33m413[39m
  }
} { phase: [32m'initialize'[39m, source: [32m'QuillAgent'[39m }

[90mstderr[2m | tests/services/gemini/agent.test.ts[2m > [22m[2mQuillAgent[2m > [22m[2mnormalizes context length exceeded errors during initialize
[22m[39m[Telemetry] Error captured UnknownAIError: Context length exceeded
    at normalizeAIError [90m(/app/[39mservices/gemini/errors.ts:64:18[90m)[39m
    at QuillAgent.initialize [90m(/app/[39mservices/gemini/factory.ts:185:13[90m)[39m
    at [90m/app/[39mtests/services/gemini/agent.test.ts:490:19
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
  isRetryable: [33mfalse[39m,
  [cause]: Error: Context length exceeded
      at Module.createContextLengthError [90m(/app/[39mtests/mocks/geminiClient.ts:148:22[90m)[39m
      at Object.<anonymous> [90m(/app/[39mtests/services/gemini/agent.test.ts:483:13[90m)[39m
      at Object.Mock [as create] [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
      at createAgentSession [90m(/app/[39mservices/gemini/factory.ts:136:19[90m)[39m
      at QuillAgent.initialize [90m(/app/[39mservices/gemini/factory.ts:183:28[90m)[39m
      at [90m/app/[39mtests/services/gemini/agent.test.ts:490:19
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
    status: [33m413[39m
  }
} { phase: [32m'initialize'[39m, source: [32m'QuillAgent'[39m }

[90mstderr[2m | tests/services/gemini/agent.test.ts[2m > [22m[2mQuillAgent[2m > [22m[2mnormalizes errors thrown by chat.sendMessage
[22m[39m[Telemetry] Error captured RateLimitError: Rate limit exceeded
    at normalizeAIError [90m(/app/[39mservices/gemini/errors.ts:62:18[90m)[39m
    at QuillAgent.sendMessage [90m(/app/[39mservices/gemini/factory.ts:206:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m {
  isRetryable: [33mtrue[39m,
  [cause]: Error: Rate limit exceeded
      at Module.createRateLimitError [90m(/app/[39mtests/mocks/geminiClient.ts:142:22[90m)[39m
      at [90m/app/[39mtests/services/gemini/agent.test.ts:504:19
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
      at new Promise (<anonymous>)
      at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
      at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
      at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
      at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m {
    status: [33m429[39m
  }
} { phase: [32m'sendMessage'[39m, source: [32m'QuillAgent'[39m }

 [32mâœ“[39m tests/services/gemini/agent.test.ts [2m([22m[2m29 tests[22m[2m)[22m[32m 71[2mms[22m[39m
 [32mâœ“[39m tests/features/editor/hooks/useTiptapSync.test.ts [2m([22m[2m25 tests[22m[2m)[22m[32m 126[2mms[22m[39m
 [32mâœ“[39m tests/services/appBrain/crossChapterContext.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 26[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/goalGraph.test.ts [2m([22m[2m30 tests[22m[2m)[22m[32m 40[2mms[22m[39m
 [32mâœ“[39m tests/mocks/testFactories.test.ts [2m([22m[2m54 tests[22m[2m)[22m[32m 33[2mms[22m[39m
[90mstderr[2m | tests/components/KnowledgeGraph.test.tsx[2m > [22m[2mKnowledgeGraph[2m > [22m[2mrenders the graph canvas when characters are present
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/components/KnowledgeGraph.test.tsx[2m > [22m[2mKnowledgeGraph[2m > [22m[2mallows selecting a character node via canvas click
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/components/KnowledgeGraph.test.tsx[2m > [22m[2mKnowledgeGraph[2m > [22m[2mdeselects character when clicking empty space
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/components/KnowledgeGraph.test.tsx[2m > [22m[2mKnowledgeGraph[2m > [22m[2msupports node dragging interactions
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/components/KnowledgeGraph.test.tsx[2m > [22m[2mKnowledgeGraph[2m > [22m[2mchanges cursor on hover and resets when leaving node
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/components/KnowledgeGraph.test.tsx[2m > [22m[2mKnowledgeGraph[2m > [22m[2mupdates dimensions on resize via window listener and ResizeObserver fallback
[22m[39mWarning: An update to KnowledgeGraph inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at KnowledgeGraph (/app/features/lore/components/KnowledgeGraph.tsx:15:27)

[90mstderr[2m | tests/components/KnowledgeGraph.test.tsx[2m > [22m[2mKnowledgeGraph[2m > [22m[2mdeduplicates lore and chapter characters and allows selecting from combined set
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/components/KnowledgeGraph.test.tsx[2m > [22m[2mKnowledgeGraph[2m > [22m[2mrenders legend and truncates if too many items
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/components/KnowledgeGraph.test.tsx[2m > [22m[2mKnowledgeGraph[2m > [22m[2mRendering Details[2m > [22m[2mrenders edges between related characters
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

 [32mâœ“[39m tests/components/KnowledgeGraph.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[32m 249[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/memoryQueries.test.ts [2m([22m[2m26 tests[22m[2m)[22m[32m 28[2mms[22m[39m
 [32mâœ“[39m tests/components/CommandPalette.test.tsx [2m([22m[2m37 tests[22m[2m)[22m[33m 1151[2mms[22m[39m
[90mstderr[2m | tests/features/agent/hooks/useProactiveSuggestions.test.ts[2m > [22m[2museProactiveSuggestions[2m > [22m[2mfetches reminders and handles errors
[22m[39m[useProactiveSuggestions] Failed to get reminders: Error: fail
    at [90m/app/[39mtests/features/agent/hooks/useProactiveSuggestions.test.ts:412:62
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

 [32mâœ“[39m tests/features/agent/hooks/useProactiveSuggestions.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 123[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/contextBuilder.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 74[2mms[22m[39m
 [32mâœ“[39m tests/services/commands/history.test.ts [2m([22m[2m33 tests[22m[2m)[22m[32m 37[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/memoryService.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 33[2mms[22m[39m
 [32mâœ“[39m tests/hooks/useDocumentHistory.test.ts [2m([22m[2m33 tests[22m[2m)[22m[32m 173[2mms[22m[39m
[90mstderr[2m | tests/components/EditorWorkspace.test.tsx[2m > [22m[2mEditorWorkspace[2m > [22m[2mrenders RichTextEditor with current text and handlers
[22m[39mWarning: Received `false` for a non-boolean attribute `initial`.

If you want to write it to the DOM, pass a string instead: initial="false" or initial={value.toString()}.

If you used to conditionally omit it with initial={condition && value}, pass initial={condition ? value : undefined} instead.
    at header
    at header (/app/tests/components/EditorWorkspace.test.tsx:8:16)
    at /app/features/editor/components/EditorWorkspace.tsx:104:3
    at AnimatePresence (/app/tests/components/EditorWorkspace.test.tsx:14:23)
    at div
    at EditorWorkspace (/app/features/editor/components/EditorWorkspace.tsx:327:57)

 [32mâœ“[39m tests/components/EditorWorkspace.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[32m 253[2mms[22m[39m
[90mstderr[2m | tests/services/gemini/audio.test.ts[2m > [22m[2mgenerateSpeech[2m > [22m[2mhandles API errors gracefully
[22m[39mTTS Error: Error: API Error
    at [90m/app/[39mtests/services/gemini/audio.test.ts:175:53
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstderr[2m | tests/services/gemini/audio.test.ts[2m > [22m[2mgenerateSpeech[2m > [22m[2mhandles audio decoding errors
[22m[39mTTS Error: Error: Decoding failed
    at [90m/app/[39mtests/services/gemini/audio.test.ts:203:50
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/services/gemini/audio.test.ts[2m > [22m[2mgenerateSpeech[2m > [22m[2mhandles malformed base64 data by returning null and closing context
[22m[39mTTS Error: Error: Invalid base64
    at [90m/app/[39mtests/services/gemini/audio.test.ts:261:13
    at Mock [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at Module.generateSpeech [90m(/app/[39mservices/gemini/audio.ts:64:9[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/services/gemini/audio.test.ts:264:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/services/gemini/audio.test.ts[2m > [22m[2mconnectLiveSession[2m > [22m[2mcalls onclose when session closes
[22m[39mLive session closed

[90mstderr[2m | tests/services/gemini/audio.test.ts[2m > [22m[2mconnectLiveSession[2m > [22m[2mcalls onclose when session errors
[22m[39mLive session error Error: Session error
    at [90m/app/[39mtests/services/gemini/audio.test.ts:400:19
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/services/gemini/audio.test.ts[2m > [22m[2mconnectLiveSession[2m > [22m[2mthrows error if Web Audio API not supported
[22m[39mTTS Error: Error: Web Audio API not supported in this environment.
    at getAudioContextCtor [90m(/app/[39mservices/gemini/audio.ts:18:11[90m)[39m
    at Module.generateSpeech [90m(/app/[39mservices/gemini/audio.ts:60:30[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstderr[2m | tests/services/gemini/audio.test.ts[2m > [22m[2mconnectLiveSession[2m > [22m[2mthrows error if Web Audio API not supported
[22m[39mTTS Error: Error: Web Audio API not supported in this environment.
    at getAudioContextCtor [90m(/app/[39mservices/gemini/audio.ts:18:11[90m)[39m
    at Module.generateSpeech [90m(/app/[39mservices/gemini/audio.ts:60:30[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/services/gemini/audio.test.ts:434:5
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/services/gemini/audio.test.ts[2m > [22m[2mconnectLiveSession[2m > [22m[2mlogs warning if closing context fails
[22m[39mFailed to close AudioContext Error: Close failed
    at new <anonymous> [90m(/app/[39mtests/services/gemini/audio.test.ts:450:46[90m)[39m
    at new Mock [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:262:27[90m)[39m
    at makeAudioContext [90m(/app/[39mservices/gemini/audio.ts:36:12[90m)[39m
    at Module.generateSpeech [90m(/app/[39mservices/gemini/audio.ts:61:26[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/services/gemini/audio.test.ts:457:5
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

 [32mâœ“[39m tests/services/gemini/audio.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 45[2mms[22m[39m
[90mstderr[2m | tests/hooks/useDraftSmithEngine.test.tsx[2m > [22m[2museQuillAIEngine[2m > [22m[2mhandles analysis failures by surfacing errors
[22m[39mAnalysis failed Error: analysis failed
    at [90m/app/[39mtests/hooks/useDraftSmithEngine.test.tsx:354:44
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

 [32mâœ“[39m tests/hooks/useDraftSmithEngine.test.tsx [2m([22m[2m16 tests[22m[2m)[22m[32m 97[2mms[22m[39m
 [32mâœ“[39m tests/features/memory/BedsideNotePanel.test.tsx [2m([22m[2m21 tests[22m[2m)[22m[33m 1214[2mms[22m[39m
Error: Uncaught [Error: useAnalysis must be used within AnalysisProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useAnalysis must be used within AnalysisProvider
    at Module.useAnalysis (/app/features/analysis/context/AnalysisContext.tsx:359:23)
    at /app/tests/context/AnalysisContext.test.tsx:66:26
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
Error: Uncaught [Error: useAnalysis must be used within AnalysisProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useAnalysis must be used within AnalysisProvider
    at Module.useAnalysis (/app/features/analysis/context/AnalysisContext.tsx:359:23)
    at /app/tests/context/AnalysisContext.test.tsx:66:26
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
[90mstderr[2m | tests/context/AnalysisContext.test.tsx[2m > [22m[2mAnalysisContext[2m > [22m[2mabortAnalysis[2m > [22m[2maborts the underlying AbortController signal for in-flight full analysis
[22m[39m[AnalysisContext] Full analysis failed: DOMException {}
Warning: An update to AnalysisProvider inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at AnalysisProvider (/app/features/analysis/context/AnalysisContext.tsx:20:29)
    at wrapper (/app/tests/context/AnalysisContext.test.tsx:18:20)

 [32mâœ“[39m tests/context/AnalysisContext.test.tsx [2m([22m[2m22 tests[22m[2m)[22m[32m 247[2mms[22m[39m
[90mstderr[2m | tests/services/pdfExport.test.ts
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/memoryToolHandlers.test.ts[2m > [22m[2mMemoryToolHandlers[2m > [22m[2mwrite_memory_note[2m > [22m[2mhandles creation error
[22m[39m[memoryToolHandlers] write_memory_note error: Error: fail
    at [90m/app/[39mtests/services/gemini/memoryToolHandlers.test.ts:121:51
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2mrenders title page and saves to filename
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2mrenders manuscript header and body
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2madds a page per configured section
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2mfalls back when character list is empty
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2mstrips chapter titles when disabled in manuscript options
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2mrenders character profiles with arcs and biographies
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2mrenders world rules as a bulleted list
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2mrenders a full analysis report with pacing, plot issues, and suggestions
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2mhandles analysis sections when optional data is missing
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2muses a sanitized title when no filename is provided
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2mfalls back to a default filename when title is empty
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2madds extra pages when manuscript content overflows the page
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/memoryToolHandlers.test.ts[2m > [22m[2mMemoryToolHandlers[2m > [22m[2msearch_memory[2m > [22m[2mhandles search error
[22m[39m[memoryToolHandlers] search_memory error: Error: fail
    at [90m/app/[39mtests/services/gemini/memoryToolHandlers.test.ts:179:50
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2mlogs and rethrows a generic error when PDF generation fails
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/memoryToolHandlers.test.ts[2m > [22m[2mMemoryToolHandlers[2m > [22m[2mupdate_memory_note[2m > [22m[2mhandles update error
[22m[39m[memoryToolHandlers] update_memory_note error: Error: fail
    at [90m/app/[39mtests/services/gemini/memoryToolHandlers.test.ts:216:51
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2mfalls back to an empty character array when lore.characters is undefined
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2mfalls back to an empty world rules array when lore.worldRules is undefined
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2muses a default biography when character bio is missing
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/memoryToolHandlers.test.ts[2m > [22m[2mMemoryToolHandlers[2m > [22m[2mdelete_memory_note[2m > [22m[2mhandles delete error
[22m[39m[memoryToolHandlers] delete_memory_note error: Error: fail
    at [90m/app/[39mtests/services/gemini/memoryToolHandlers.test.ts:235:51
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstderr[2m | tests/services/gemini/memoryToolHandlers.test.ts[2m > [22m[2mMemoryToolHandlers[2m > [22m[2mcreate_goal[2m > [22m[2mhandles create goal error
[22m[39m[memoryToolHandlers] create_goal error: Error: fail
    at [90m/app/[39mtests/services/gemini/memoryToolHandlers.test.ts:255:46
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2mforces a page break when rendering near the bottom margin
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2mapplies heading and body fonts when rendering section titles
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/memoryToolHandlers.test.ts[2m > [22m[2mMemoryToolHandlers[2m > [22m[2mupdate_goal[2m > [22m[2mhandles update goal error
[22m[39m[memoryToolHandlers] update_goal error: Error: fail
    at [90m/app/[39mtests/services/gemini/memoryToolHandlers.test.ts:286:49
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstderr[2m | tests/services/pdfExport.test.ts[2m > [22m[2mPDFExportService[2m > [22m[2mfalls back to placeholder content when section text is missing
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/memoryToolHandlers.test.ts[2m > [22m[2mMemoryToolHandlers[2m > [22m[2mwatch_entity[2m > [22m[2mhandles watch entity error
[22m[39m[memoryToolHandlers] watch_entity error: Error: fail
    at [90m/app/[39mtests/services/gemini/memoryToolHandlers.test.ts:306:55
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

 [32mâœ“[39m tests/services/pdfExport.test.ts [2m([22m[2m19 tests[22m[2m)[22m[32m 90[2mms[22m[39m
 [32mâœ“[39m tests/services/gemini/memoryToolHandlers.test.ts [2m([22m[2m37 tests[22m[2m)[22m[32m 106[2mms[22m[39m
 [32mâœ“[39m tests/hooks/useInlineComments.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 65[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/semanticDedup.test.ts [2m([22m[2m31 tests[22m[2m)[22m[32m 34[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/structuralParser.test.ts [2m([22m[2m30 tests[22m[2m)[22m[32m 58[2mms[22m[39m
 [32mâœ“[39m tests/features/editor/hooks/useChunkIndex.test.tsx [2m([22m[2m13 tests[22m[2m)[22m[32m 88[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/voiceProfiles.test.ts [2m([22m[2m19 tests[22m[2m)[22m[32m 25[2mms[22m[39m
[90mstderr[2m | tests/features/agent/hooks/useMemoryIntelligence.test.ts[2m > [22m[2museMemoryIntelligence[2m > [22m[2mdoes not respond to ANALYSIS_COMPLETED if autoObserve is disabled
[22m[39mWarning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:307:5)

 [32mâœ“[39m tests/features/agent/hooks/useMemoryIntelligence.test.ts [2m([22m[2m19 tests[22m[2m)[22m[32m 119[2mms[22m[39m
 [32mâœ“[39m tests/hooks/useAgentService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 86[2mms[22m[39m
 [32mâœ“[39m tests/features/analysis/components/AnalysisPanel.test.tsx [2m([22m[2m18 tests[22m[2m)[22m[33m 401[2mms[22m[39m
 [32mâœ“[39m tests/features/voice/hooks/useAudioController.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 77[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/bedsideNoteMutations.test.ts [2m([22m[2m22 tests[22m[2m)[22m[32m 33[2mms[22m[39m
 [32mâœ“[39m tests/services/io/docxExporter.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 42[2mms[22m[39m
[90mstderr[2m | tests/components/MagicBar.test.tsx[2m > [22m[2mMagicBar[2m > [22m[2mrenders variations view and applies selections
[22m[39mWarning: An update to MagicBarComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at MagicBarComponent (/app/features/editor/components/MagicBar.tsx:259:3)

[90mstderr[2m | tests/components/MagicBar.test.tsx[2m > [22m[2mMagicBar[2m > [22m[2mresets copy feedback after timeout
[22m[39mWarning: An update to MagicBarComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at MagicBarComponent (/app/features/editor/components/MagicBar.tsx:259:3)

 [32mâœ“[39m tests/components/MagicBar.test.tsx [2m([22m[2m13 tests[22m[2m)[22m[33m 502[2mms[22m[39m
 [32mâœ“[39m tests/features/index-exports.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 1048[2mms[22m[39m
       [33m[2mâœ“[22m[39m exports all agent components and hooks [33m 682[2mms[22m[39m
       [33m[2mâœ“[22m[39m exports all layout components and store [33m 312[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/sessionTracker.test.ts [2m([22m[2m38 tests[22m[2m)[22m[32m 32[2mms[22m[39m
 [32mâœ“[39m tests/services/commands/navigation.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 21[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/heatmapBuilder.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 19[2mms[22m[39m
 [32mâœ“[39m tests/features/editor/components/StoryVersionsPanel.test.tsx [2m([22m[2m17 tests[22m[2m)[22m[33m 634[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/memoryToolHandlers.test.ts [2m([22m[2m22 tests[22m[2m)[22m[32m 54[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/worker.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 78[2mms[22m[39m
[90mstderr[2m | tests/services/manuscriptIndexer.test.ts
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/manuscriptIndexer.test.ts[2m > [22m[2mextractEntities[2m > [22m[2mhandles JSON parsing errors gracefully
[22m[39m[ManuscriptIndexer] Failed to parse extraction result SyntaxError: Unexpected token 'I', "Invalid JSON" is not valid JSON
    at JSON.parse (<anonymous>)
    at Module.extractEntities [90m(/app/[39mservices/manuscriptIndexer.ts:86:25[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/services/manuscriptIndexer.test.ts:326:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

 [32mâœ“[39m tests/services/manuscriptIndexer.test.ts [2m([22m[2m19 tests[22m[2m)[22m[32m 29[2mms[22m[39m
[90mstderr[2m | tests/config/api.test.ts[2m > [22m[2mgetApiKey[2m > [22m[2mlogs warning only once for missing key
[22m[39m[Quill AI] No API key configured. Set GEMINI_API_KEY in your environment.

[90mstderr[2m | tests/config/api.test.ts[2m > [22m[2mgetApiKey[2m > [22m[2mwarns once and returns empty string when no keys are set
[22m[39m[Quill AI] No API key configured. Set GEMINI_API_KEY in your environment.

[90mstdout[2m | tests/config/api.test.ts[2m > [22m[2mDual API Key Management[2m > [22m[2mswitches to paid key if free quota exhausted
[22m[39m[Quill AI] Free tier quota exhausted, switching to paid tier.

[90mstderr[2m | tests/config/api.test.ts[2m > [22m[2mDual API Key Management[2m > [22m[2mcorrectly identifies if any key is configured
[22m[39m[Quill AI] No API key configured. Set GEMINI_API_KEY in your environment.
[Quill AI] No API key configured. Set GEMINI_API_KEY in your environment.

 [32mâœ“[39m tests/config/api.test.ts [2m([22m[2m25 tests[22m[2m)[22m[32m 27[2mms[22m[39m
 [32mâœ“[39m tests/components/ProjectDashboard.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 501[2mms[22m[39m
 [32mâœ“[39m tests/services/manuscriptParser.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 25[2mms[22m[39m
 [32mâœ“[39m tests/components/VersionControlPanel.test.tsx [2m([22m[2m25 tests[22m[2m)[22m[33m 897[2mms[22m[39m
[90mstderr[2m | tests/features/voice/hooks/useVoiceSession.test.ts[2m > [22m[2museVoiceSession[2m > [22m[2mhandles start session errors
[22m[39m[useVoiceSession] Failed to start: Error: Permission denied
    at [90m/app/[39mtests/features/voice/hooks/useVoiceSession.test.ts:168:68
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstderr[2m | tests/features/voice/hooks/useVoiceSession.test.ts[2m > [22m[2museVoiceSession[2m > [22m[2muses generic error message for non-Error rejections
[22m[39m[useVoiceSession] Failed to start: nope

[90mstderr[2m | tests/features/voice/hooks/useVoiceSession.test.ts[2m > [22m[2museVoiceSession[2m > [22m[2mthrows an error when Web Audio API is not available
[22m[39m[useVoiceSession] Failed to start: Error: Web Audio API not supported in this environment.
    at Object.startSession [90m(/app/[39mfeatures/voice/hooks/useVoiceSession.ts:189:15[90m)[39m
[90m    at runNextTicks (node:internal/process/task_queues:65:5)[39m
[90m    at listOnTimeout (node:internal/timers:549:9)[39m
[90m    at processTimers (node:internal/timers:523:7)[39m
    at [90m/app/[39mtests/features/voice/hooks/useVoiceSession.test.ts:274:7

 [32mâœ“[39m tests/features/voice/hooks/useVoiceSession.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 102[2mms[22m[39m
[90mstderr[2m | tests/features/agent/components/ProactiveSuggestions.test.tsx[2m > [22m[2mProactiveSuggestions[2m > [22m[2mrenders suggestions count and dismiss all button
[22m[39mWarning: Received `true` for a non-boolean attribute `layout`.

If you want to write it to the DOM, pass a string instead: layout="true" or layout={value.toString()}.
    at div
    at div (/app/tests/features/agent/components/ProactiveSuggestions.test.tsx:3:13)
    at AnimatePresence (/app/tests/features/agent/components/ProactiveSuggestions.test.tsx:14:23)
    at div
    at ProactiveSuggestions (/app/features/agent/components/ProactiveSuggestions.tsx:61:3)

 [32mâœ“[39m tests/features/agent/components/ProactiveSuggestions.test.tsx [2m([22m[2m22 tests[22m[2m)[22m[32m 275[2mms[22m[39m
 [32mâœ“[39m tests/services/core/toolRunner.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 30[2mms[22m[39m
 [32mâœ“[39m tests/mocks/geminiClient.test.ts [2m([22m[2m39 tests[22m[2m)[22m[32m 31[2mms[22m[39m
[90mstderr[2m | tests/features/shared/hooks/useDraftSmithEngine.test.ts[2m > [22m[2museQuillAIEngine[2m > [22m[2mAnalysis Logic[2m > [22m[2mhandles analysis error
[22m[39mAnalysis failed Error: API Error
    at [90m/app/[39mtests/features/shared/hooks/useDraftSmithEngine.test.ts:127:51
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

 [32mâœ“[39m tests/features/shared/hooks/useDraftSmithEngine.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 96[2mms[22m[39m
 [32mâœ“[39m tests/services/core/agentSession.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 23[2mms[22m[39m
 [32mâœ“[39m tests/components/AccessibleTooltip.test.tsx [2m([22m[2m17 tests[22m[2m)[22m[32m 280[2mms[22m[39m
[90mstdout[2m | tests/integration/proactive-flow.test.ts[2m > [22m[2mProactive Flow Integration[2m > [22m[2mProactiveThinker[2m > [22m[2mgenerates suggestions when events are batched and debounce fires
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"test-project"}

[90mstderr[2m | tests/integration/proactive-flow.test.ts[2m > [22m[2mProactive Flow Integration[2m > [22m[2mProactiveThinker[2m > [22m[2mgenerates suggestions when events are batched and debounce fires
[22m[39m[AppBrain][ProactiveThinker] Bedside evolve failed

[90mstdout[2m | tests/integration/proactive-flow.test.ts[2m > [22m[2mProactive Flow Integration[2m > [22m[2mProactiveThinker[2m > [22m[2mgenerates suggestions when events are batched and debounce fires
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/integration/proactive-flow.test.ts[2m > [22m[2mProactive Flow Integration[2m > [22m[2mProactiveThinker[2m > [22m[2memits PROACTIVE_THINKING_STARTED and PROACTIVE_THINKING_COMPLETED events
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"test-project"}

[90mstderr[2m | tests/integration/proactive-flow.test.ts[2m > [22m[2mProactive Flow Integration[2m > [22m[2mProactiveThinker[2m > [22m[2memits PROACTIVE_THINKING_STARTED and PROACTIVE_THINKING_COMPLETED events
[22m[39m[AppBrain][ProactiveThinker] Bedside evolve failed

[90mstdout[2m | tests/integration/proactive-flow.test.ts[2m > [22m[2mProactive Flow Integration[2m > [22m[2mProactiveThinker[2m > [22m[2memits PROACTIVE_THINKING_STARTED and PROACTIVE_THINKING_COMPLETED events
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/integration/proactive-flow.test.ts[2m > [22m[2mProactive Flow Integration[2m > [22m[2mProactiveThinker[2m > [22m[2mtreats SIGNIFICANT_EDIT_DETECTED as an urgent event
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"test-project"}

[90mstderr[2m | tests/integration/proactive-flow.test.ts[2m > [22m[2mProactive Flow Integration[2m > [22m[2mProactiveThinker[2m > [22m[2mtreats SIGNIFICANT_EDIT_DETECTED as an urgent event
[22m[39m[AppBrain][ProactiveThinker] Bedside evolve failed

[90mstdout[2m | tests/integration/proactive-flow.test.ts[2m > [22m[2mProactive Flow Integration[2m > [22m[2mProactiveThinker[2m > [22m[2mtreats SIGNIFICANT_EDIT_DETECTED as an urgent event
[22m[39m[AppBrain][ProactiveThinker] Stopped

[90mstdout[2m | tests/integration/proactive-flow.test.ts[2m > [22m[2mProactive Flow Integration[2m > [22m[2mEnd-to-end flow[2m > [22m[2meditor change triggers SignificantEditMonitor which triggers ProactiveThinker
[22m[39m[AppBrain][ProactiveThinker] Started {"projectId":"test-project"}

[90mstderr[2m | tests/integration/proactive-flow.test.ts[2m > [22m[2mProactive Flow Integration[2m > [22m[2mEnd-to-end flow[2m > [22m[2meditor change triggers SignificantEditMonitor which triggers ProactiveThinker
[22m[39m[AppBrain][ProactiveThinker] Bedside evolve failed

[90mstdout[2m | tests/integration/proactive-flow.test.ts[2m > [22m[2mProactive Flow Integration[2m > [22m[2mEnd-to-end flow[2m > [22m[2meditor change triggers SignificantEditMonitor which triggers ProactiveThinker
[22m[39m[AppBrain][ProactiveThinker] Stopped

 [32mâœ“[39m tests/integration/proactive-flow.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 60[2mms[22m[39m
 [32mâœ“[39m tests/components/Input.test.tsx [2m([22m[2m32 tests[22m[2m)[22m[32m 285[2mms[22m[39m
[90mstderr[2m | tests/services/intelligence/chunkManager_coverage.test.ts[2m > [22m[2mChunkManager coverage[2m > [22m[2mshould handle errors during processing
[22m[39m[ChunkManager] Error processing chapter-chError: Processing failed

[90mstderr[2m | tests/services/intelligence/chunkManager_coverage.test.ts[2m > [22m[2mChunkManager coverage[2m > [22m[2mgetChunkText should return null for invalid indices or missing text
[22m[39m[ChunkManager] Error processing chapter-ch1: Could not retrieve chunk text (invalid range or missing chapter)

[90mstderr[2m | tests/services/intelligence/chunkManager_coverage.test.ts[2m > [22m[2mChunkManager coverage[2m > [22m[2mgetChunkText should return null for invalid scene indices
[22m[39m[ChunkManager] Error processing scene-bad: Could not retrieve chunk text (invalid range or missing chapter)

[90mstderr[2m | tests/services/intelligence/chunkManager_coverage.test.ts[2m > [22m[2mChunkManager coverage[2m > [22m[2mshould pause and resume
[22m[39m[ChunkManager] Error processing chapter-ch1-scene-0: Could not retrieve chunk text (invalid range or missing chapter)

[90mstderr[2m | tests/services/intelligence/chunkManager_coverage.test.ts[2m > [22m[2mChunkManager coverage[2m > [22m[2mretryErrors should return chunk IDs
[22m[39m[ChunkManager] Error processing chapter-chErr: Fail

 [32mâœ“[39m tests/services/intelligence/chunkManager_coverage.test.ts [2m([22m[2m22 tests[22m[2m)[22m[32m 42[2mms[22m[39m
[90mstderr[2m | tests/services/gemini/direct-actions.test.ts[2m > [22m[2mdirect-actions[2m > [22m[2mgenerateContinuation[2m > [22m[2mthrows when model returns empty text
[22m[39m[generateContinuation] Failed to generate continuation AIError: No continuation was returned from the model.
    at Module.generateContinuation [90m(/app/[39mservices/gemini/direct-actions.ts:112:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m {
  isRetryable: [33mfalse[39m
}

[90mstderr[2m | tests/services/gemini/direct-actions.test.ts[2m > [22m[2mdirect-actions[2m > [22m[2mgenerateContinuation[2m > [22m[2mthrows when model returns null text
[22m[39m[generateContinuation] Failed to generate continuation AIError: No continuation was returned from the model.
    at Module.generateContinuation [90m(/app/[39mservices/gemini/direct-actions.ts:112:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m {
  isRetryable: [33mfalse[39m
}

 [32mâœ“[39m tests/services/gemini/direct-actions.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 31[2mms[22m[39m
 [32mâœ“[39m tests/features/layout/EditorLayout.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[33m 309[2mms[22m[39m
[90mstderr[2m | tests/hooks/useMagicEditor.test.ts[2m > [22m[2museMagicEditor[2m > [22m[2mhandles help request failure gracefully
[22m[39mError: Help API Error
    at [90m/app/[39mtests/hooks/useMagicEditor.test.ts:156:52
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstderr[2m | tests/hooks/useMagicEditor.test.ts[2m > [22m[2museMagicEditor[2m > [22m[2mhandles rewrite failure gracefully
[22m[39mError: API Error
    at [90m/app/[39mtests/hooks/useMagicEditor.test.ts:215:46
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

 [32mâœ“[39m tests/hooks/useMagicEditor.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 97[2mms[22m[39m
Error: Uncaught [Error: useEngine must be used within an EngineProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useEngine must be used within an EngineProvider
    at Module.useEngine (/app/features/core/context/EngineContext.tsx:223:11)
    at /app/tests/features/core/EngineContext.test.tsx:122:26
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
Error: Uncaught [Error: useEngine must be used within an EngineProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useEngine must be used within an EngineProvider
    at Module.useEngine (/app/features/core/context/EngineContext.tsx:223:11)
    at /app/tests/features/core/EngineContext.test.tsx:122:26
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
[90mstderr[2m | tests/features/core/EngineContext.test.tsx[2m > [22m[2mEngineContext[2m > [22m[2museEngine hook[2m > [22m[2mthrows when used outside provider
[22m[39mThe above error occurred in the <TestComponent> component:

    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:307:5)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

 [32mâœ“[39m tests/features/core/EngineContext.test.tsx [2m([22m[2m19 tests[22m[2m)[22m[32m 96[2mms[22m[39m
 [32mâœ“[39m tests/services/appBrain/dreamingService.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 91[2mms[22m[39m
 [32mâœ“[39m tests/components/Typography.test.tsx [2m([22m[2m29 tests[22m[2m)[22m[32m 143[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/sceneEmbedder.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 20[2mms[22m[39m
 [32mâœ“[39m tests/components/EditorLayout.test.tsx [2m([22m[2m14 tests[22m[2m)[22m[33m 328[2mms[22m[39m
 [32mâœ“[39m tests/features/analysis/components/ShadowReaderPanel.test.tsx [2m([22m[2m11 tests[22m[2m)[22m[33m 365[2mms[22m[39m
 [32mâœ“[39m tests/features/settings/store/useSettingsStore.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 30[2mms[22m[39m
[90mstderr[2m | tests/services/resilientParser.test.ts[2m > [22m[2msafeParseJson[2m > [22m[2mreturns fallback for empty response
[22m[39m[Telemetry] Error captured Error: Empty response received
    at notifyFailure [90m(/app/[39mservices/gemini/resilientParser.ts:159:21[90m)[39m
    at safeParseJson [90m(/app/[39mservices/gemini/resilientParser.ts:164:5[90m)[39m
    at [90m/app/[39mtests/services/resilientParser.test.ts:71:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m {
  error: [32m'Empty response received'[39m,
  rawResponse: [32m''[39m,
  snippet: [90mundefined[39m,
  sanitized: [33mfalse[39m
}

[90mstderr[2m | tests/services/resilientParser.test.ts[2m > [22m[2msafeParseJson[2m > [22m[2mreturns fallback for null response
[22m[39m[Telemetry] Error captured Error: Empty response received
    at notifyFailure [90m(/app/[39mservices/gemini/resilientParser.ts:159:21[90m)[39m
    at safeParseJson [90m(/app/[39mservices/gemini/resilientParser.ts:164:5[90m)[39m
    at [90m/app/[39mtests/services/resilientParser.test.ts:79:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m {
  error: [32m'Empty response received'[39m,
  rawResponse: [1mnull[22m,
  snippet: [90mundefined[39m,
  sanitized: [33mfalse[39m
}

[90mstderr[2m | tests/services/resilientParser.test.ts[2m > [22m[2msafeParseJson[2m > [22m[2mreturns fallback for undefined response
[22m[39m[Telemetry] Error captured Error: Empty response received
    at notifyFailure [90m(/app/[39mservices/gemini/resilientParser.ts:159:21[90m)[39m
    at safeParseJson [90m(/app/[39mservices/gemini/resilientParser.ts:164:5[90m)[39m
    at [90m/app/[39mtests/services/resilientParser.test.ts:86:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m {
  error: [32m'Empty response received'[39m,
  rawResponse: [90mundefined[39m,
  snippet: [90mundefined[39m,
  sanitized: [33mfalse[39m
}

[90mstderr[2m | tests/services/resilientParser.test.ts[2m > [22m[2msafeParseJson[2m > [22m[2mreturns fallback for completely invalid JSON
[22m[39m[Telemetry] Error captured Error: Failed to parse JSON after sanitization
    at notifyFailure [90m(/app/[39mservices/gemini/resilientParser.ts:159:21[90m)[39m
    at safeParseJson [90m(/app/[39mservices/gemini/resilientParser.ts:198:3[90m)[39m
    at [90m/app/[39mtests/services/resilientParser.test.ts:93:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m {
  error: [32m'Failed to parse JSON after sanitization'[39m,
  rawResponse: [32m'not json at all'[39m,
  snippet: [32m'not json at all'[39m,
  sanitized: [33mfalse[39m
}

[90mstderr[2m | tests/services/resilientParser.test.ts[2m > [22m[2msafeParseJson[2m > [22m[2mreturns fallback when array extraction finds invalid JSON
[22m[39m[Telemetry] Error captured Error: Failed to parse JSON after sanitization
    at notifyFailure [90m(/app/[39mservices/gemini/resilientParser.ts:159:21[90m)[39m
    at safeParseJson [90m(/app/[39mservices/gemini/resilientParser.ts:198:3[90m)[39m
    at [90m/app/[39mtests/services/resilientParser.test.ts:126:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m {
  error: [32m'Failed to parse JSON after sanitization'[39m,
  rawResponse: [32m'Items: [not, valid, json] end of response'[39m,
  snippet: [32m'Items: [not, valid, json] end of response'[39m,
  sanitized: [33mfalse[39m
}

[90mstderr[2m | tests/services/resilientParser.test.ts[2m > [22m[2msafeParseJson[2m > [22m[2mfalls back when parsing extracted JSON fails after extraction
[22m[39m[Telemetry] Error captured Error: Failed to parse JSON after sanitization
    at notifyFailure [90m(/app/[39mservices/gemini/resilientParser.ts:159:21[90m)[39m
    at safeParseJson [90m(/app/[39mservices/gemini/resilientParser.ts:198:3[90m)[39m
    at [90m/app/[39mtests/services/resilientParser.test.ts:166:22
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m {
  error: [32m'Failed to parse JSON after sanitization'[39m,
  rawResponse: [32m'{"ok": true}'[39m,
  snippet: [32m'{"ok": true}'[39m,
  sanitized: [33mtrue[39m
}

[90mstderr[2m | tests/services/resilientParser.test.ts[2m > [22m[2msafeParseJsonWithValidation[2m > [22m[2mreturns fallback when validation fails
[22m[39m[Telemetry] Error captured Error: Response does not match expected schema
    at safeParseJsonWithValidation [90m(/app/[39mservices/gemini/resilientParser.ts:236:19[90m)[39m
    at [90m/app/[39mtests/services/resilientParser.test.ts:191:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m { rawResponse: [90mundefined[39m }

[90mstderr[2m | tests/services/resilientParser.test.ts[2m > [22m[2msafeParseJsonWithValidation[2m > [22m[2mreturns fallback for invalid JSON
[22m[39m[Telemetry] Error captured Error: Failed to parse JSON after sanitization
    at notifyFailure [90m(/app/[39mservices/gemini/resilientParser.ts:159:21[90m)[39m
    at safeParseJson [90m(/app/[39mservices/gemini/resilientParser.ts:198:3[90m)[39m
    at safeParseJsonWithValidation [90m(/app/[39mservices/gemini/resilientParser.ts:216:18[90m)[39m
    at [90m/app/[39mtests/services/resilientParser.test.ts:202:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37 {
  error: [32m'Failed to parse JSON after sanitization'[39m,
  rawResponse: [32m'not json'[39m,
  snippet: [32m'not json'[39m,
  sanitized: [33mfalse[39m
}

 [32mâœ“[39m tests/services/resilientParser.test.ts [2m([22m[2m35 tests[22m[2m)[22m[32m 45[2mms[22m[39m
[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mConfiguration & Initialization[2m > [22m[2misApiConfigured returns true when API key is valid
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mConfiguration & Initialization[2m > [22m[2mgetApiStatus returns configured status when valid
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mConfiguration & Initialization[2m > [22m[2mexports ai client instance
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mConfiguration & Initialization[2m > [22m[2mrecreates client when API key changes
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mConfiguration & Initialization[2m > [22m[2mrecreates client when API key changes
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mInvalid Configuration[2m > [22m[2mreports invalid configuration via status API when API key is missing
[22m[39m[Quill AI API] API key is required

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mInvalid Configuration[2m > [22m[2mcreates a proxy that throws on access if key is invalid
[22m[39m[Quill AI API] Invalid format

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mSmart Generate Content (The "ai" Proxy)[2m > [22m[2mproxies normal requests successfully
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mSmart Generate Content (The "ai" Proxy)[2m > [22m[2mhandles string requests by wrapping them
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mSmart Generate Content (The "ai" Proxy)[2m > [22m[2mpasses through other properties (e.g., chats)
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mSmart Generate Content (The "ai" Proxy)[2m > [22m[2mQuota Exhaustion Handling[2m > [22m[2mrethrows non-quota errors
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mSmart Generate Content (The "ai" Proxy)[2m > [22m[2mQuota Exhaustion Handling[2m > [22m[2mNormal/Cheap Mode (Paid Key Switch)[2m > [22m[2mswitches to paid key on 429 error if not already using paid key
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstdout[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mSmart Generate Content (The "ai" Proxy)[2m > [22m[2mQuota Exhaustion Handling[2m > [22m[2mNormal/Cheap Mode (Paid Key Switch)[2m > [22m[2mswitches to paid key on 429 error if not already using paid key
[22m[39m[Quill AI] Switching to Paid Key for normal mode.

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mSmart Generate Content (The "ai" Proxy)[2m > [22m[2mQuota Exhaustion Handling[2m > [22m[2mNormal/Cheap Mode (Paid Key Switch)[2m > [22m[2mswitches to paid key on 429 error if not already using paid key
[22m[39m[Quill AI] Quota exhausted (normal mode). Attempting recovery...

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mSmart Generate Content (The "ai" Proxy)[2m > [22m[2mQuota Exhaustion Handling[2m > [22m[2mNormal/Cheap Mode (Paid Key Switch)[2m > [22m[2mrethrows 429 if already using paid key
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mSmart Generate Content (The "ai" Proxy)[2m > [22m[2mQuota Exhaustion Handling[2m > [22m[2mNormal/Cheap Mode (Paid Key Switch)[2m > [22m[2mrethrows 429 if already using paid key
[22m[39m[Quill AI] Quota exhausted (normal mode). Attempting recovery...

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mSmart Generate Content (The "ai" Proxy)[2m > [22m[2mQuota Exhaustion Handling[2m > [22m[2mNormal/Cheap Mode (Paid Key Switch)[2m > [22m[2mrethrows if retry also fails
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstdout[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mSmart Generate Content (The "ai" Proxy)[2m > [22m[2mQuota Exhaustion Handling[2m > [22m[2mNormal/Cheap Mode (Paid Key Switch)[2m > [22m[2mrethrows if retry also fails
[22m[39m[Quill AI] Switching to Paid Key for normal mode.

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mSmart Generate Content (The "ai" Proxy)[2m > [22m[2mQuota Exhaustion Handling[2m > [22m[2mNormal/Cheap Mode (Paid Key Switch)[2m > [22m[2mrethrows if retry also fails
[22m[39m[Quill AI] Quota exhausted (normal mode). Attempting recovery...

[90mstderr[2m | tests/services/gemini/client.test.ts[2m > [22m[2mGemini Client[2m > [22m[2mSmart Generate Content (The "ai" Proxy)[2m > [22m[2mQuota Exhaustion Handling[2m > [22m[2mNormal/Cheap Mode (Paid Key Switch)[2m > [22m[2mrethrows if retry also fails
[22m[39m[Quill AI] Paid key also exhausted or unavailable.

 [32mâœ“[39m tests/services/gemini/client.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 44[2mms[22m[39m
 [32mâœ“[39m tests/services/appBrain/significantEditMonitor.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 44[2mms[22m[39m
 [32mâœ“[39m tests/helpers/testUtils.test.ts [2m([22m[2m34 tests[22m[2m)[22m[32m 55[2mms[22m[39m
 [32mâœ“[39m tests/features/shared/hooks/UsageContext.test.tsx [2m([22m[2m13 tests[22m[2m)[22m[32m 97[2mms[22m[39m
[90mstderr[2m | tests/services/gemini/grammar.test.ts[2m > [22m[2mfetchGrammarSuggestions[2m > [22m[2mreturns empty suggestions when signal is aborted during API call
[22m[39m[fetchGrammarSuggestions] Failed to generate grammar suggestions DOMException {}

[90mstderr[2m | tests/services/gemini/grammar.test.ts[2m > [22m[2mfetchGrammarSuggestions[2m > [22m[2mreturns empty suggestions on API error
[22m[39m[fetchGrammarSuggestions] Failed to generate grammar suggestions Error: API Error
    at [90m/app/[39mtests/services/gemini/grammar.test.ts:196:64
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstderr[2m | tests/services/gemini/grammar.test.ts[2m > [22m[2mfetchGrammarSuggestions[2m > [22m[2mhandles malformed JSON response gracefully
[22m[39m[Telemetry] Error captured Error: Failed to parse JSON after sanitization
    at notifyFailure [90m(/app/[39mservices/gemini/resilientParser.ts:159:21[90m)[39m
    at safeParseJson [90m(/app/[39mservices/gemini/resilientParser.ts:198:3[90m)[39m
    at Module.fetchGrammarSuggestions [90m(/app/[39mservices/gemini/grammar.ts:131:20[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/services/gemini/grammar.test.ts:209:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
  error: [32m'Failed to parse JSON after sanitization'[39m,
  rawResponse: [32m'not valid json'[39m,
  snippet: [32m'not valid json'[39m,
  sanitized: [33mfalse[39m
}

 [32mâœ“[39m tests/services/gemini/grammar.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 37[2mms[22m[39m
[90mstderr[2m | tests/services/intelligence/chunkManager.integration.test.ts[2m > [22m[2mChunkManager Integration & Worker[2m > [22m[2mhandles worker errors gracefully
[22m[39m[ChunkManager] Error processing chapter-error-ch-scene-0: Worker exploded

[90mstderr[2m | tests/services/intelligence/chunkManager.integration.test.ts[2m > [22m[2mChunkManager Integration & Worker[2m > [22m[2mhandles worker errors gracefully
[22m[39m[ChunkManager] Error processing chapter-error-ch: Worker exploded

 [32mâœ“[39m tests/services/intelligence/chunkManager.integration.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 24[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/deltaTracker.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 27[2mms[22m[39m
 [32mâœ“[39m tests/services/appBrain/driftDetector.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 15[2mms[22m[39m
 [32mâœ“[39m tests/services/commands/generation.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 21[2mms[22m[39m
[90mstderr[2m | tests/services/appBrain/runtime.test.ts[2m > [22m[2mAppBrainRuntime[2m > [22m[2mstart[2m > [22m[2mlogs warning when starting while already running
[22m[39m[AppBrain][Runtime] start() called while already running. Call stop() first.

[90mstderr[2m | tests/services/appBrain/runtime.test.ts[2m > [22m[2mAppBrainRuntime[2m > [22m[2mswitchProject[2m > [22m[2mlogs warning when switching while not running
[22m[39m[AppBrain][Runtime] Cannot switch project: runtime not running

 [32mâœ“[39m tests/services/appBrain/runtime.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 35[2mms[22m[39m
 [32mâœ“[39m tests/hooks/useEditorBranching.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 69[2mms[22m[39m
 [32mâœ“[39m tests/hooks/useAgenticEditor.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 55[2mms[22m[39m
 [32mâœ“[39m tests/components/NavigationRail.test.tsx [2m([22m[2m21 tests[22m[2m)[22m[33m 663[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/entityExtractor_coverage.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 37[2mms[22m[39m
 [32mâœ“[39m tests/features/layout/MainLayout.test.tsx [2m([22m[2m11 tests[22m[2m)[22m[32m 142[2mms[22m[39m
 [32mâœ“[39m tests/components/FindReplaceModal.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 389[2mms[22m[39m
 [32mâœ“[39m tests/features/editor/hooks/useAutoResize.test.tsx [2m([22m[2m9 tests[22m[2m)[22m[32m 164[2mms[22m[39m
[90mstderr[2m | tests/services/memory/dreaming.test.ts[2m > [22m[2mDreaming Service[2m > [22m[2mshould handle missing AI response fields gracefully
[22m[39m[Dreaming] Failed to parse LLM response, using fallback SyntaxError: Unexpected token 'I', "Invalid JSON" is not valid JSON
    at JSON.parse (<anonymous>)
    at parseDreamingResponse [90m(/app/[39mservices/memory/dreaming.ts:48:25[90m)[39m
    at summarizeEpisodicMemories [90m(/app/[39mservices/memory/dreaming.ts:80:10[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.runDreamingCycle [90m(/app/[39mservices/memory/dreaming.ts:159:19[90m)[39m
    at [90m/app/[39mtests/services/memory/dreaming.test.ts:120:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

 [32mâœ“[39m tests/services/memory/cache.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 20[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/dreaming.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 32[2mms[22m[39m
 [32mâœ“[39m tests/services/gemini/prompts.test.ts [2m([22m[2m36 tests[22m[2m)[22m[32m 20[2mms[22m[39m
 [32mâœ“[39m tests/services/core/agentToolLoop.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 23[2mms[22m[39m
 [32mâœ“[39m tests/hooks/useEditorComments.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 58[2mms[22m[39m
 [32mâœ“[39m tests/features/layout/store/useLayoutStore.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 99[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/narrativeArc.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 17[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/types.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 17[2mms[22m[39m
 [32mâœ“[39m tests/services/core/agentStateFactory.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/bedsideHistorySearch.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/voiceProfiler.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 45[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/memoryScoring.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m tests/services/gemini/factory.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 20[2mms[22m[39m
 [32mâœ“[39m tests/components/FileUpload.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[33m 425[2mms[22m[39m
[90mstdout[2m | tests/services/appBrain/logger.test.ts[2m > [22m[2mAppBrainLogger[2m > [22m[2mlog levels[2m > [22m[2mrespects log level settings
[22m[39m[AppBrain][TestService] Info message

[90mstdout[2m | tests/services/appBrain/logger.test.ts[2m > [22m[2mAppBrainLogger[2m > [22m[2mcustom handlers[2m > [22m[2mcalls custom handlers with log entries
[22m[39m[AppBrain][TestService] Test message {"projectId":"test-123"}

[90mstdout[2m | tests/services/appBrain/logger.test.ts[2m > [22m[2mAppBrainLogger[2m > [22m[2mcustom handlers[2m > [22m[2maddHandler returns unsubscribe function
[22m[39m[AppBrain][TestService] First message
[AppBrain][TestService] Second message

[90mstdout[2m | tests/services/appBrain/logger.test.ts[2m > [22m[2mAppBrainLogger[2m > [22m[2mcustom handlers[2m > [22m[2mhandler errors do not break logging
[22m[39m[AppBrain][TestService] Test message

[90mstderr[2m | tests/services/appBrain/logger.test.ts[2m > [22m[2mAppBrainLogger[2m > [22m[2mcustom handlers[2m > [22m[2mhandler errors do not break logging
[22m[39m[AppBrain] Log handler error: Error: Handler error
    at [90m/app/[39mtests/services/appBrain/logger.test.ts:91:15
    at Mock [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at AppBrainLogger.log [90m(/app/[39mservices/appBrain/logger.ts:130:9[90m)[39m
    at AppBrainLogger.info [90m(/app/[39mservices/appBrain/logger.ts:93:10[90m)[39m
    at [90m/app/[39mtests/services/appBrain/logger.test.ts:101:24
    at Proxy.assertThrows [90m(file:///app/[39mnode_modules/[4mchai[24m/index.js:2798:5[90m)[39m
    at Proxy.methodWrapper [90m(file:///app/[39mnode_modules/[4mchai[24m/index.js:1700:25[90m)[39m
    at Proxy.<anonymous> [90m(file:///app/[39mnode_modules/[4m@vitest/expect[24m/dist/index.js:1149:12[90m)[39m
    at Proxy.overwritingMethodWrapper [90m(file:///app/[39mnode_modules/[4mchai[24m/index.js:1750:33[90m)[39m
    at Proxy.<anonymous> [90m(file:///app/[39mnode_modules/[4m@vitest/expect[24m/dist/index.js:1485:16[90m)[39m

[90mstdout[2m | tests/services/appBrain/logger.test.ts[2m > [22m[2mAppBrainLogger[2m > [22m[2mlog methods[2m > [22m[2mdebug logs with correct level
[22m[39m[AppBrain][TestService] Debug message

[90mstdout[2m | tests/services/appBrain/logger.test.ts[2m > [22m[2mAppBrainLogger[2m > [22m[2mlog methods[2m > [22m[2minfo logs with correct level
[22m[39m[AppBrain][TestService] Info message

[90mstderr[2m | tests/services/appBrain/logger.test.ts[2m > [22m[2mAppBrainLogger[2m > [22m[2mlog methods[2m > [22m[2mwarn logs with correct level
[22m[39m[AppBrain][TestService] Warn message

[90mstderr[2m | tests/services/appBrain/logger.test.ts[2m > [22m[2mAppBrainLogger[2m > [22m[2mlog methods[2m > [22m[2merror logs with correct level and includes error object
[22m[39m[AppBrain][TestService] Error message  Error: Test error
    at [90m/app/[39mtests/services/appBrain/logger.test.ts:153:25
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

[90mstderr[2m | tests/services/appBrain/logger.test.ts[2m > [22m[2mAppBrainLogger[2m > [22m[2mlog methods[2m > [22m[2merror logs message without error object
[22m[39m[AppBrain][TestService] Error message without object

[90mstdout[2m | tests/services/appBrain/logger.test.ts[2m > [22m[2mAppBrainLogger[2m > [22m[2mcontext formatting[2m > [22m[2mformats context as JSON
[22m[39m[AppBrain][TestService] Test message {"projectId":"test-123","chapterId":"chapter-1"}

[90mstdout[2m | tests/services/appBrain/logger.test.ts[2m > [22m[2mcreateServiceLogger[2m > [22m[2mcreates a scoped logger for a service
[22m[39m[AppBrain][MyService] Test message

 [32mâœ“[39m tests/services/appBrain/logger.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 34[2mms[22m[39m
 [32mâœ“[39m tests/components/MainLayout.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 299[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/bedside/schema.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 31[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/sessionLifecycle.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 19[2mms[22m[39m
 [32mâœ“[39m tests/features/debug/components/BrainActivityMonitor.test.tsx [2m([22m[2m9 tests[22m[2m)[22m[32m 171[2mms[22m[39m
 [32mâœ“[39m tests/hooks/useAutoResize.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 58[2mms[22m[39m
 [32mâœ“[39m tests/services/core/contextService.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 14[2mms[22m[39m
Error: Uncaught [Error: useAppBrain must be used within AppBrainProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useAppBrain must be used within AppBrainProvider
    at Module.useAppBrain (/app/features/core/context/AppBrainContext.tsx:613:11)
    at /app/tests/context/AppBrainContext.test.tsx:164:24
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
Error: Uncaught [Error: useAppBrain must be used within AppBrainProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useAppBrain must be used within AppBrainProvider
    at Module.useAppBrain (/app/features/core/context/AppBrainContext.tsx:613:11)
    at /app/tests/context/AppBrainContext.test.tsx:164:24
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
[90mstdout[2m | tests/context/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mprovides unified state and context builders inside provider
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/context/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2mprovides unified state and context builders inside provider
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/context/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2memits selection and cursor events when editor state changes
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/context/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2memits selection and cursor events when editor state changes
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/context/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2memits chapter switched event when active chapter changes
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/context/AppBrainContext.test.tsx[2m > [22m[2mAppBrainContext[2m > [22m[2memits chapter switched event when active chapter changes
[22m[39m[FeedbackTracker] Stopped

 [32mâœ“[39m tests/context/AppBrainContext.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 70[2mms[22m[39m
 [32mâœ“[39m tests/components/ExperienceSelector.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 126[2mms[22m[39m
 [32mâœ“[39m tests/hooks/useVoiceSession.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 47[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/structuralParser_coverage.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 31[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/bedsideNoteSerializer.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mâœ“[39m tests/hooks/useManuscriptIndexer.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 61[2mms[22m[39m
 [32mâœ“[39m tests/features/settings/components/RelevanceTuning.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 330[2mms[22m[39m
 [32mâœ“[39m tests/features/editor/extensions/CommentMark.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 44[2mms[22m[39m
[90mstderr[2m | services/intelligence/chunkManager.test.ts[2m > [22m[2mChunkManager processing callbacks[2m > [22m[2mfires callbacks for successful processing and error scenarios
[22m[39m[ChunkManager] Error processing chapter-1-scene-0: analysis failure

 [32mâœ“[39m services/intelligence/chunkManager.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 22[2mms[22m[39m
 [32mâœ“[39m tests/extensions/CommentMark.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m tests/App.test.tsx [2m([22m[2m6 tests[22m[2m)[22m[32m 112[2mms[22m[39m
 [32mâœ“[39m tests/features/layout/NavigationRail.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[32m 237[2mms[22m[39m
 [32mâœ“[39m tests/components/ZenModeOverlay.test.tsx [2m([22m[2m15 tests[22m[2m)[22m[32m 141[2mms[22m[39m
 [32mâœ“[39m tests/services/core/abortCoordinator.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 19[2mms[22m[39m
 [32mâœ“[39m tests/services/tokenGuard.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 53[2mms[22m[39m
 [32mâœ“[39m tests/types/schema.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 15[2mms[22m[39m
 [32mâœ“[39m tests/features/shared/utils/textLocator.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 18[2mms[22m[39m
 [32mâœ“[39m tests/features/export/utils/exportFormats.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 31[2mms[22m[39m
 [32mâœ“[39m tests/features/shared/components/Icons.test.tsx [2m([22m[2m22 tests[22m[2m)[22m[32m 124[2mms[22m[39m
 [32mâœ“[39m tests/components/ui/Spinner.test.tsx [2m([22m[2m20 tests[22m[2m)[22m[32m 194[2mms[22m[39m
[90mstderr[2m | tests/components/CritiqueIntensitySelector.test.tsx[2m > [22m[2mCritiqueIntensitySelector[2m > [22m[2mrenders all presets in compact mode using titles
[22m[39mWarning: React does not recognize the `layoutId` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `layoutid` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
    at div
    at div (/app/tests/components/CritiqueIntensitySelector.test.tsx:20:13)
    at button
    at div
    at CritiqueIntensitySelector (/app/features/settings/components/CritiqueIntensitySelector.tsx:8:38)

[90mstderr[2m | tests/components/CritiqueIntensitySelector.test.tsx[2m > [22m[2mCritiqueIntensitySelector[2m > [22m[2mrenders labels and descriptions in full mode
[22m[39mWarning: React does not recognize the `whileHover` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `whilehover` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
    at button
    at button (/app/tests/components/CritiqueIntensitySelector.test.tsx:25:16)
    at div
    at div
    at CritiqueIntensitySelector (/app/features/settings/components/CritiqueIntensitySelector.tsx:8:38)
Warning: React does not recognize the `whileTap` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `whiletap` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
    at button
    at button (/app/tests/components/CritiqueIntensitySelector.test.tsx:25:16)
    at div
    at div
    at CritiqueIntensitySelector (/app/features/settings/components/CritiqueIntensitySelector.tsx:8:38)

 [32mâœ“[39m tests/components/CritiqueIntensitySelector.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 214[2mms[22m[39m
Error: Uncaught [Error: useEngine must be used within an EngineProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useEngine must be used within an EngineProvider
    at Module.useEngine (/app/features/core/context/EngineContext.tsx:223:11)
    at Consumer (/app/tests/context/EngineContext.test.tsx:113:7)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
Error: Uncaught [Error: useEngine must be used within an EngineProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useEngine must be used within an EngineProvider
    at Module.useEngine (/app/features/core/context/EngineContext.tsx:223:11)
    at Consumer (/app/tests/context/EngineContext.test.tsx:113:7)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
 [32mâœ“[39m tests/context/EngineContext.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 97[2mms[22m[39m
 [32mâœ“[39m tests/features/analysis/components/BrainstormingPanel.test.tsx [2m([22m[2m9 tests[22m[2m)[22m[33m 362[2mms[22m[39m
Error: Uncaught [Error: useUsage must be used within UsageProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useUsage must be used within UsageProvider
    at useUsage (/app/features/shared/context/UsageContext.tsx:139:23)
    at Consumer (/app/tests/context/UsageContext.test.tsx:50:7)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
Error: Uncaught [Error: useUsage must be used within UsageProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useUsage must be used within UsageProvider
    at useUsage (/app/features/shared/context/UsageContext.tsx:139:23)
    at Consumer (/app/tests/context/UsageContext.test.tsx:50:7)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
 [32mâœ“[39m tests/context/UsageContext.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[32m 145[2mms[22m[39m
 [32mâœ“[39m tests/components/ProjectSidebar.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 418[2mms[22m[39m
[90mstderr[2m | tests/features/agent/components/AIPresenceOrb.test.tsx[2m > [22m[2mAIPresenceOrb[2m > [22m[2mrenders correctly with default props
[22m[39mWarning: React does not recognize the `whileHover` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `whilehover` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
    at button
    at button (/app/tests/features/agent/components/AIPresenceOrb.test.tsx:11:18)
    at AIPresenceOrb (/app/features/agent/components/AIPresenceOrb.tsx:8:3)
Warning: React does not recognize the `whileTap` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `whiletap` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
    at button
    at button (/app/tests/features/agent/components/AIPresenceOrb.test.tsx:11:18)
    at AIPresenceOrb (/app/features/agent/components/AIPresenceOrb.tsx:8:3)

 [32mâœ“[39m tests/features/agent/components/AIPresenceOrb.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 427[2mms[22m[39m
[90mstderr[2m | tests/features/voice/hooks/useTextToSpeech.test.tsx[2m > [22m[2museTextToSpeech[2m > [22m[2msurfaces errors from the audio pipeline
[22m[39mError: boom
    at [90m/app/[39mtests/features/voice/hooks/useTextToSpeech.test.tsx:72:13
    at Mock [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at Object.play [90m(/app/[39mfeatures/voice/hooks/useTextToSpeech.ts:40:33[90m)[39m
    at [90m/app/[39mtests/features/voice/hooks/useTextToSpeech.test.tsx:77:28
    at [90m/app/[39mnode_modules/[4m@testing-library/react[24m/dist/act-compat.js:48:24
    at act [90m(/app/[39mnode_modules/[4mreact[24m/cjs/react.development.js:2512:16[90m)[39m
    at Proxy.<anonymous> [90m(/app/[39mnode_modules/[4m@testing-library/react[24m/dist/act-compat.js:47:25[90m)[39m
    at [90m/app/[39mtests/features/voice/hooks/useTextToSpeech.test.tsx:76:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26

[90mstderr[2m | tests/features/voice/hooks/useTextToSpeech.test.tsx[2m > [22m[2museTextToSpeech[2m > [22m[2mfails gracefully when Web Audio API is unavailable
[22m[39mError: Web Audio API not supported in this environment.
    at Object.play [90m(/app/[39mfeatures/voice/hooks/useTextToSpeech.ts:50:17[90m)[39m
    at [90m/app/[39mtests/features/voice/hooks/useTextToSpeech.test.tsx:156:7

 [32mâœ“[39m tests/features/voice/hooks/useTextToSpeech.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[32m 74[2mms[22m[39m
 [32mâœ“[39m tests/features/project/ProjectDashboardFlow.integration.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 184[2mms[22m[39m
 [32mâœ“[39m tests/components/DesignSystemKitchenSink.test.tsx [2m([22m[2m11 tests[22m[2m)[22m[33m 313[2mms[22m[39m
 [32mâœ“[39m tests/features/shared/hooks/useViewportCollision.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 38[2mms[22m[39m
 [32mâœ“[39m tests/features/editor/hooks/useBranching.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 51[2mms[22m[39m
[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mdecreases weight on dismiss
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mdecreases weight on dismiss
[22m[39m[FeedbackTracker] Adjusted weight for pacing: 1 -> 0.95 (dismissed)

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mdecreases weight on dismiss
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mincreases weight on apply
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mincreases weight on apply
[22m[39m[FeedbackTracker] Adjusted weight for lore_discovery: 1 -> 1.05 (applied)

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mincreases weight on apply
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mmutes weight on muted action
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mmutes weight on muted action
[22m[39m[FeedbackTracker] Adjusted weight for style: 1 -> 0 (muted)

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mmutes weight on muted action
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mclamps weight to reasonable bounds
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mclamps weight to reasonable bounds
[22m[39m[FeedbackTracker] Adjusted weight for plot: 1.95 -> 2 (applied)
[FeedbackTracker] Adjusted weight for plot: 0.101 -> 0.1 (dismissed)

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mclamps weight to reasonable bounds
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mhandles categories without an existing weight entry
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mhandles categories without an existing weight entry
[22m[39m[FeedbackTracker] Adjusted weight for experimental: 1 -> 0.95 (dismissed)

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mhandles categories without an existing weight entry
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mstops safely even when not started
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mstops safely even when not started
[22m[39m[FeedbackTracker] Stopped
[FeedbackTracker] Stopped
[FeedbackTracker] Stopped

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mstops safely even when not started
[22m[39m[FeedbackTracker] Stopped

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mevent type guard prevents processing wrong event types
[22m[39m[FeedbackTracker] Started

[90mstdout[2m | tests/services/appBrain/feedbackTracker.test.ts[2m > [22m[2mFeedbackTracker[2m > [22m[2mevent type guard prevents processing wrong event types
[22m[39m[FeedbackTracker] Stopped

 [32mâœ“[39m tests/features/voice/components/VoiceCommandButton.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[32m 230[2mms[22m[39m
 [32mâœ“[39m tests/services/appBrain/feedbackTracker.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 22[2mms[22m[39m
 [32mâœ“[39m tests/features/export/components/ExportModal.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[33m 333[2mms[22m[39m
 [32mâœ“[39m tests/services/errorReporter.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 18[2mms[22m[39m
 [32mâœ“[39m tests/services/appBrain/eventObserver.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 76[2mms[22m[39m
 [32mâœ“[39m tests/features/settings/components/ApiKeyManager.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[32m 277[2mms[22m[39m
 [32mâœ“[39m tests/features/shared/utils/grammarNormalizer.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mâœ“[39m tests/hooks/useEditorSelection.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 52[2mms[22m[39m
 [32mâœ“[39m tests/integration/agent-flow.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 451[2mms[22m[39m
     [33m[2mâœ“[22m[39m executes agent tool calls that update the manuscript [33m 448[2mms[22m[39m
 [32mâœ“[39m tests/components/CommentCard.test.tsx [2m([22m[2m6 tests[22m[2m)[22m[32m 275[2mms[22m[39m
 [32mâœ“[39m tests/services/gemini/tokenGuard.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 33[2mms[22m[39m
[90mstderr[2m | tests/features/lore/components/KnowledgeGraph.test.tsx[2m > [22m[2mKnowledgeGraph[2m > [22m[2mrenders a legend and truncates at 5 items
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/features/lore/components/KnowledgeGraph.test.tsx[2m > [22m[2mKnowledgeGraph[2m > [22m[2mselects a node on click and renders hovered link label on subsequent frame
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/features/lore/components/KnowledgeGraph.test.tsx[2m > [22m[2mKnowledgeGraph[2m > [22m[2msupports dragging a node without throwing
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

 [32mâœ“[39m tests/features/lore/components/KnowledgeGraph.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 108[2mms[22m[39m
[90mstdout[2m | tests/services/appBrain/narrativeAlignment.test.ts[2m > [22m[2mrunNarrativeAlignmentCheck[2m > [22m[2mdetects drift and evolves bedside note
[22m[39m[NarrativeAlignment] Evolved bedside note with 1 conflicts.

[90mstderr[2m | tests/services/appBrain/narrativeAlignment.test.ts[2m > [22m[2mrunNarrativeAlignmentCheck[2m > [22m[2mhandles missing chapter gracefully
[22m[39m[NarrativeAlignment] Chapter chap-1 not found.

 [32mâœ“[39m tests/services/appBrain/narrativeAlignment.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mâœ“[39m tests/features/shared/components/AccessibleTooltip.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[32m 179[2mms[22m[39m
 [32mâœ“[39m tests/features/agent/useProactiveSuggestions.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 46[2mms[22m[39m
 [32mâœ“[39m tests/services/intelligence/index_coverage.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 52[2mms[22m[39m
 [32mâœ“[39m tests/services/core/toolCallAdapter.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 19[2mms[22m[39m
 [32mâœ“[39m tests/components/UsageBadge.test.tsx [2m([22m[2m6 tests[22m[2m)[22m[32m 145[2mms[22m[39m
 [32mâœ“[39m tests/features/shared/utils/textReplacer.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 14[2mms[22m[39m
[90mstderr[2m | tests/features/settings/components/ThemeSelector.test.tsx[2m > [22m[2mThemeSelector[2m > [22m[2mrenders theme selector correctly
[22m[39mWarning: React does not recognize the `layoutId` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `layoutid` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
    at div
    at div (/app/tests/features/settings/components/ThemeSelector.test.tsx:3:13)
    at div
    at div
    at div
    at Card (/app/tests/features/settings/components/ThemeSelector.test.tsx:11:12)
    at ThemeOption (/app/features/settings/components/ThemeSelector.tsx:239:24)
    at div
    at div
    at div
    at ThemeSelector

 [32mâœ“[39m tests/features/settings/components/ThemeSelector.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[32m 178[2mms[22m[39m
 [32mâœ“[39m tests/services/commands/knowledge.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mâœ“[39m tests/components/IssueCard.test.tsx [2m([22m[2m14 tests[22m[2m)[22m[32m 105[2mms[22m[39m
 [32mâœ“[39m tests/services/commands/ui.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 15[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/relevance.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 13[2mms[22m[39m
[90mstderr[2m | tests/services/agent/readerService.test.ts[2m > [22m[2mReaderService.generateReactions[2m > [22m[2mreturns error InlineComment when JSON is malformed
[22m[39mFailed to parse AI-generated JSON: SyntaxError: Unexpected token 'o', "not json" is not valid JSON
    at JSON.parse (<anonymous>)
    at ReaderService.generateReactions [90m(/app/[39mservices/agent/readerService.ts:55:26[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/services/agent/readerService.test.ts:71:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20
AI output: not json

[90mstderr[2m | tests/services/agent/readerService.test.ts[2m > [22m[2mReaderService.generateReactions[2m > [22m[2mreturns error InlineComment when generation fails
[22m[39mError generating reader reactions: Error: AI offline
    at [90m/app/[39mtests/services/agent/readerService.test.ts:109:43
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

 [32mâœ“[39m tests/features/voice/hooks/useSpeechIntent.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 55[2mms[22m[39m
 [32mâœ“[39m tests/services/agent/readerService.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 22[2mms[22m[39m
 [32mâœ“[39m tests/features/analysis/components/CharactersSection.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[32m 196[2mms[22m[39m
 [32mâœ“[39m tests/services/gemini/errors.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 36[2mms[22m[39m
[90mstderr[2m | tests/features/settings/components/ModelBuildSelector.test.tsx[2m > [22m[2mModelBuildSelector[2m > [22m[2mStandard Mode[2m > [22m[2mrenders all preset options
[22m[39mWarning: React does not recognize the `whileHover` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `whilehover` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
    at div
    at Card (/app/tests/features/settings/components/ModelBuildSelector.test.tsx:11:12)
    at PresetCard (/app/features/settings/components/ModelBuildSelector.tsx:24:23)
    at div
    at div
    at ModelBuildSelector (/app/features/settings/components/ModelBuildSelector.tsx:142:3)
Warning: React does not recognize the `whileTap` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `whiletap` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
    at div
    at Card (/app/tests/features/settings/components/ModelBuildSelector.test.tsx:11:12)
    at PresetCard (/app/features/settings/components/ModelBuildSelector.tsx:24:23)
    at div
    at div
    at ModelBuildSelector (/app/features/settings/components/ModelBuildSelector.tsx:142:3)

 [32mâœ“[39m tests/features/settings/components/ModelBuildSelector.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[33m 617[2mms[22m[39m
 [32mâœ“[39m tests/features/shared/hooks/useThrottledValue.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 129[2mms[22m[39m
 [32mâœ“[39m tests/features/analysis/components/SettingConsistencySection.test.tsx [2m([22m[2m9 tests[22m[2m)[22m[33m 727[2mms[22m[39m
 [32mâœ“[39m tests/features/layout/EditorHeader.test.tsx [2m([22m[2m6 tests[22m[2m)[22m[33m 345[2mms[22m[39m
 [32mâœ“[39m tests/hooks/useAudioController.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 41[2mms[22m[39m
 [32mâœ“[39m tests/types/personas.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mâœ“[39m tests/services/commands/analysis.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 15[2mms[22m[39m
Error: Uncaught [Error: useAppBrainActionsContext must be used within an AppBrainActionsProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useAppBrainActionsContext must be used within an AppBrainActionsProvider
    at useAppBrainActionsContext (/app/features/core/context/AppBrainActionsContext.tsx:57:11)
    at /app/tests/features/core/context/AppBrainActionsContext.test.tsx:95:26
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
Error: Uncaught [Error: useAppBrainActionsContext must be used within an AppBrainActionsProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useAppBrainActionsContext must be used within an AppBrainActionsProvider
    at useAppBrainActionsContext (/app/features/core/context/AppBrainActionsContext.tsx:57:11)
    at /app/tests/features/core/context/AppBrainActionsContext.test.tsx:95:26
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
 [32mâœ“[39m tests/features/core/context/AppBrainActionsContext.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[32m 107[2mms[22m[39m
 [32mâœ“[39m tests/features/project/ImportWizardFlow.integration.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[33m 574[2mms[22m[39m
     [33m[2mâœ“[22m[39m walks through configure -> review -> complete while surfacing chapter health panels [33m 461[2mms[22m[39m
 [32mâœ“[39m tests/features/core/context/AnalysisStatusContext.test.tsx [2m([22m[2m6 tests[22m[2m)[22m[32m 112[2mms[22m[39m
 [32mâœ“[39m tests/features/settings/components/ExperienceSelector.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 281[2mms[22m[39m
 [32mâœ“[39m tests/services/core/agentOrchestratorMachine.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 25[2mms[22m[39m
 [32mâœ“[39m tests/store/useSettingsStore.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 19[2mms[22m[39m
 [32mâœ“[39m tests/features/shared/utils/selectionValidator.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 15[2mms[22m[39m
 [32mâœ“[39m services/intelligence/worker.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 28[2mms[22m[39m
 [32mâœ“[39m tests/features/editor/components/CommentCard.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[33m 333[2mms[22m[39m
[90mstderr[2m | tests/features/agent/ProactiveSuggestions.test.tsx[2m > [22m[2mProactiveSuggestions interactions[2m > [22m[2mhandles dismiss all, menu toggling, and feedback actions
[22m[39mWarning: Received `true` for a non-boolean attribute `layout`.

If you want to write it to the DOM, pass a string instead: layout="true" or layout={value.toString()}.
    at div
    at div (/app/tests/features/agent/ProactiveSuggestions.test.tsx:3:13)
    at AnimatePresence (/app/tests/features/agent/ProactiveSuggestions.test.tsx:14:23)
    at div
    at ProactiveSuggestions (/app/features/agent/components/ProactiveSuggestions.tsx:61:3)

 [32mâœ“[39m tests/features/agent/ProactiveSuggestions.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 160[2mms[22m[39m
 [32mâœ“[39m tests/hooks/useBranching.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 51[2mms[22m[39m
 [32mâœ“[39m tests/features/voice/components/VoiceMode.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 225[2mms[22m[39m
 [32mâœ“[39m tests/components/VoiceMode.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[32m 187[2mms[22m[39m
 [32mâœ“[39m tests/features/memory/components/BedsideNoteHistory.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 256[2mms[22m[39m
 [32mâœ“[39m tests/features/analysis/components/ExecutiveSummary.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 197[2mms[22m[39m
 [32mâœ“[39m tests/features/analysis/components/Dashboard.test.tsx [2m([22m[2m6 tests[22m[2m)[22m[32m 81[2mms[22m[39m
 [32mâœ“[39m tests/features/editor/components/VersionControlPanel.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[33m 338[2mms[22m[39m
 [32mâœ“[39m tests/components/Workspace.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[32m 84[2mms[22m[39m
 [32mâœ“[39m tests/utils/diffUtils.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m tests/features/analysis/readerStore.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 34[2mms[22m[39m
 [32mâœ“[39m tests/features/agent/components/ActivityFeed.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[32m 168[2mms[22m[39m
 [32mâœ“[39m tests/integration/analysis-flow.test.tsx [2m([22m[2m1 test[22m[2m)[22m[32m 41[2mms[22m[39m
 [32mâœ“[39m tests/components/BrainstormingPanel.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[33m 587[2mms[22m[39m
     [33m[2mâœ“[22m[39m allows selecting suggestion type and generating ideas [33m 360[2mms[22m[39m
 [32mâœ“[39m tests/features/analysis/components/PlotIssuesSection.test.tsx [2m([22m[2m6 tests[22m[2m)[22m[32m 145[2mms[22m[39m
Error: Uncaught [Error: useMagicEditorContext must be used within a MagicEditorProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useMagicEditorContext must be used within a MagicEditorProvider
    at useMagicEditorContext (/app/features/core/context/MagicEditorContext.tsx:67:11)
    at /app/tests/features/core/context/MagicEditorContext.test.tsx:76:39
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
Error: Uncaught [Error: useMagicEditorContext must be used within a MagicEditorProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useMagicEditorContext must be used within a MagicEditorProvider
    at useMagicEditorContext (/app/features/core/context/MagicEditorContext.tsx:67:11)
    at /app/tests/features/core/context/MagicEditorContext.test.tsx:76:39
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
 [32mâœ“[39m tests/features/core/context/MagicEditorContext.test.tsx [2m([22m[2m6 tests[22m[2m)[22m[32m 94[2mms[22m[39m
[90mstderr[2m | tests/hooks/usePlotSuggestions.test.tsx[2m > [22m[2musePlotSuggestions[2m > [22m[2mcaptures error for latest request only
[22m[39mFailed to generate plot ideas Error: fail
    at [90m/app/[39mtests/hooks/usePlotSuggestions.test.tsx:77:19
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:12[90m)[39m

 [32mâœ“[39m tests/hooks/usePlotSuggestions.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 58[2mms[22m[39m
 [32mâœ“[39m tests/components/LoadingScreen.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[32m 119[2mms[22m[39m
 [32mâœ“[39m tests/features/settings/components/DeveloperModeToggle.test.tsx [2m([22m[2m9 tests[22m[2m)[22m[32m 182[2mms[22m[39m
 [32mâœ“[39m tests/components/SettingConsistencySection.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[32m 108[2mms[22m[39m
 [32mâœ“[39m tests/hooks/useTextToSpeech.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 40[2mms[22m[39m
Error: Uncaught [Error: useGrammarContext must be used within a GrammarProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useGrammarContext must be used within a GrammarProvider
    at useGrammarContext (/app/features/core/context/GrammarContext.tsx:65:11)
    at /app/tests/features/core/context/GrammarContext.test.tsx:72:39
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
Error: Uncaught [Error: useGrammarContext must be used within a GrammarProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useGrammarContext must be used within a GrammarProvider
    at useGrammarContext (/app/features/core/context/GrammarContext.tsx:65:11)
    at /app/tests/features/core/context/GrammarContext.test.tsx:72:39
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
 [32mâœ“[39m tests/features/core/context/GrammarContext.test.tsx [2m([22m[2m6 tests[22m[2m)[22m[32m 76[2mms[22m[39m
 [32mâœ“[39m tests/types/experienceSettings.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mâœ“[39m tests/types/export.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mâœ“[39m tests/features/shared/animations.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 15[2mms[22m[39m
 [32mâœ“[39m tests/features/analysis/components/PacingSection.test.tsx [2m([22m[2m6 tests[22m[2m)[22m[32m 216[2mms[22m[39m
 [32mâœ“[39m tests/components/CharactersSection.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[32m 116[2mms[22m[39m
 [32mâœ“[39m tests/components/Dashboard.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 273[2mms[22m[39m
 [32mâœ“[39m tests/features/analysis/components/IssueCard.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[32m 174[2mms[22m[39m
 [32mâœ“[39m tests/features/debug/BrainActivityMonitor.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 110[2mms[22m[39m
Error: Uncaught [Error: useAppBrainStatusContext must be used within an AppBrainStatusProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useAppBrainStatusContext must be used within an AppBrainStatusProvider
    at useAppBrainStatusContext (/app/features/core/context/AppBrainStatusContext.tsx:63:11)
    at /app/tests/features/core/context/AppBrainStatusContext.test.tsx:46:39
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
Error: Uncaught [Error: useAppBrainStatusContext must be used within an AppBrainStatusProvider]
    at reportException (/app/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/app/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/app/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/app/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
    at performUnitOfWork (/app/node_modules/react-dom/cjs/react-dom.development.js:26599:12) Error: useAppBrainStatusContext must be used within an AppBrainStatusProvider
    at useAppBrainStatusContext (/app/features/core/context/AppBrainStatusContext.tsx:63:11)
    at /app/tests/features/core/context/AppBrainStatusContext.test.tsx:46:39
    at TestComponent (/app/node_modules/@testing-library/react/dist/pure.js:309:27)
    at renderWithHooks (/app/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
    at mountIndeterminateComponent (/app/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
    at beginWork (/app/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (/app/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/app/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/app/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
 [32mâœ“[39m tests/features/core/context/AppBrainStatusContext.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 107[2mms[22m[39m
 [32mâœ“[39m tests/components/PersonaSelector.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 155[2mms[22m[39m
 [32mâœ“[39m tests/public/audio-processor.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 19[2mms[22m[39m
 [32mâœ“[39m tests/features/layout/ToolsPanelContainer.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 56[2mms[22m[39m
 [32mâœ“[39m tests/services/commands/editing.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mâœ“[39m tests/components/ErrorBoundary.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[32m 206[2mms[22m[39m
 [32mâœ“[39m tests/components/PacingSection.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[32m 241[2mms[22m[39m
 [32mâœ“[39m tests/services/db.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 19[2mms[22m[39m
 [32mâœ“[39m tests/config/models.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mâœ“[39m tests/services/appBrain/types.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m tests/services/core/agentContextBuilder.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m tests/components/ExecutiveSummary.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 181[2mms[22m[39m
 [32mâœ“[39m tests/features/memory/components/MemoryNotifications.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[32m 66[2mms[22m[39m
 [32mâœ“[39m tests/services/core/promptBuilder.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m tests/features/shared/components/ui/Input.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 84[2mms[22m[39m
 [32mâœ“[39m tests/features/layout/ZenModeOverlay.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 183[2mms[22m[39m
 [32mâœ“[39m tests/features/settings/components/NativeSpellcheckToggle.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 213[2mms[22m[39m
 [32mâœ“[39m tests/types/critiqueSettings.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/features/index.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/services/commands/registry.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 21[2mms[22m[39m
 [32mâœ“[39m tests/services/io/manuscriptExport.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m tests/features/analysis/components/StrengthsWeaknesses.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 97[2mms[22m[39m
 [32mâœ“[39m tests/features/layout/store/useFocusStore.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mâœ“[39m tests/features/analysis/components/ScoreCard.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[32m 138[2mms[22m[39m
 [32mâœ“[39m tests/services/io/docxImporter.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 19[2mms[22m[39m
 [32mâœ“[39m tests/hooks/useViewportCollision.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 52[2mms[22m[39m
 [32mâœ“[39m tests/components/PlotIssuesSection.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 77[2mms[22m[39m
 [32mâœ“[39m tests/font_repro.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 92[2mms[22m[39m
 [32mâœ“[39m tests/features/settings/components/BudgetSelector.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[32m 239[2mms[22m[39m
 [32mâœ“[39m tests/integration/project-flow.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 415[2mms[22m[39m
     [33m[2mâœ“[22m[39m creates a project, opens first chapter, and persists edits [33m 412[2mms[22m[39m
 [32mâœ“[39m tests/services/memory/bedsideEmbeddings.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mâœ“[39m tests/services/audioUtils.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mâœ“[39m tests/features/editor/components/MagicBar.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 103[2mms[22m[39m
 [32mâœ“[39m tests/components/StrengthsWeaknesses.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 85[2mms[22m[39m
 [32mâœ“[39m tests/features/editor/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/components/DiffViewer.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 87[2mms[22m[39m
 [32mâœ“[39m tests/services/gemini/experiencePrompts.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/components/VisualDiff.test.tsx [2m([22m[2m1 test[22m[2m)[22m[32m 54[2mms[22m[39m
 [32mâœ“[39m tests/config/heuristics.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/factories/analysisResultFactory.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/features/analysis/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/features/settings/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 7[2mms[22m[39m
 [32mâœ“[39m tests/services/gemini/critiquePrompts.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/features/core/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m tests/features/agent/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m tests/components/UploadLayout.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[32m 55[2mms[22m[39m
 [32mâœ“[39m tests/config/index.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/features/project/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m tests/features/voice/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m tests/features/layout/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m tests/features/lore/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m tests/features/memory/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 5[2mms[22m[39m
 [32mâœ“[39m tests/features/debug/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 5[2mms[22m[39m

[2m Test Files [22m [1m[32m306 passed[39m[22m[90m (306)[39m
[2m      Tests [22m [1m[32m4531 passed[39m[22m[90m (4531)[39m
[2m   Start at [22m 16:54:02
[2m   Duration [22m 174.33s[2m (transform 13.96s, setup 104.57s, import 42.74s, tests 52.76s, environment 205.10s)[22m

JSON report written to /app/coverage/vitest-report.json
[34m % [39m[2mCoverage report from [22m[33mv8[39m
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s
-------------------|---------|----------|---------|---------|-------------------
All files          |   95.99 |    88.86 |   95.02 |   96.83 |
 app               |     100 |    94.44 |     100 |     100 |
  App.tsx          |     100 |    91.66 |     100 |     100 | 38
  types.ts         |     100 |      100 |     100 |     100 |
 app/config        |      93 |    85.88 |     100 |      93 |
  api.ts           |   94.23 |    91.22 |     100 |   94.23 | 29,60-61
  heuristics.ts    |     100 |      100 |     100 |     100 |
  index.ts         |     100 |      100 |     100 |     100 |
  models.ts        |   90.47 |       75 |     100 |   90.47 | 34-37,230
 app/features      |     100 |      100 |     100 |     100 |
  index.ts         |     100 |      100 |     100 |     100 |
 ...features/agent |       0 |        0 |       0 |       0 |
  index.ts         |       0 |        0 |       0 |       0 |
 ...ent/components |   99.23 |    92.73 |   98.48 |   99.15 |
  ...esenceOrb.tsx |      96 |    96.42 |     100 |      96 | 370
  ActivityFeed.tsx |     100 |      100 |     100 |     100 |
  ...Interface.tsx |     100 |    91.26 |     100 |     100 | ...45,492-494,640
  ...aSelector.tsx |     100 |    93.54 |     100 |     100 | 29,43
  ...ggestions.tsx |   97.77 |    91.46 |   93.33 |   97.36 | 308
 ...es/agent/hooks |   93.49 |     80.9 |   94.78 |   94.16 |
  ...chestrator.ts |   93.08 |    76.59 |   94.28 |   93.75 | ...14,431-442,452
  ...entService.ts |   84.94 |    74.46 |   95.83 |   85.88 | ...29-134,139,203
  ...nticEditor.ts |     100 |    88.88 |     100 |     100 | 78,110-111
  ...telligence.ts |    95.5 |    87.75 |   84.21 |   95.34 | 81,88-98
  ...uggestions.ts |   96.87 |    83.09 |     100 |   98.18 | 147,193
 ...tures/analysis |     100 |      100 |     100 |     100 |
  index.ts         |       0 |        0 |       0 |       0 |
  readerStore.ts   |     100 |      100 |     100 |     100 |
 ...sis/components |   97.54 |    95.06 |     100 |    98.9 |
  ...ysisPanel.tsx |     100 |    98.21 |     100 |     100 | 40
  ...mingPanel.tsx |   94.11 |    92.85 |     100 |     100 | 19
  ...rsSection.tsx |     100 |    89.28 |     100 |     100 | 13,23,42
  Dashboard.tsx    |     100 |      100 |     100 |     100 |
  ...veSummary.tsx |   92.85 |    93.75 |     100 |     100 | 16
  IssueCard.tsx    |     100 |      100 |     100 |     100 |
  ...ngSection.tsx |    92.3 |     90.9 |     100 |   93.93 | 31-32
  ...esSection.tsx |     100 |    93.75 |     100 |     100 | 15
  ScoreCard.tsx    |     100 |      100 |     100 |     100 |
  ...cySection.tsx |     100 |      100 |     100 |     100 |
  ...aderPanel.tsx |     100 |    97.05 |     100 |     100 | 155
  ...eaknesses.tsx |     100 |      100 |     100 |     100 |
 ...alysis/context |   98.43 |     92.3 |     100 |    98.4 |
  ...isContext.tsx |   98.43 |     92.3 |     100 |    98.4 | 254-255
 app/features/core |       0 |        0 |       0 |       0 |
  index.ts         |       0 |        0 |       0 |       0 |
 ...s/core/context |   98.25 |    88.57 |    97.1 |   98.39 |
  ...usContext.tsx |     100 |      100 |     100 |     100 |
  ...nsContext.tsx |     100 |      100 |     100 |     100 |
  ...inContext.tsx |   96.68 |    84.69 |   94.73 |    96.4 | ...92,406,543-544
  ...usContext.tsx |     100 |      100 |     100 |     100 |
  ...orContext.tsx |   98.61 |    93.75 |   95.23 |     100 | 160
  ...neContext.tsx |     100 |      100 |     100 |     100 |
  ...arContext.tsx |     100 |      100 |     100 |     100 |
  ...orContext.tsx |     100 |      100 |     100 |     100 |
 ...features/debug |       0 |        0 |       0 |       0 |
  index.ts         |       0 |        0 |       0 |       0 |
 ...bug/components |   95.65 |    95.23 |     100 |   94.87 |
  ...tyMonitor.tsx |   95.65 |    95.23 |     100 |   94.87 | 25,109
 ...eatures/editor |       0 |        0 |       0 |       0 |
  index.ts         |       0 |        0 |       0 |       0 |
 ...tor/components |   88.55 |     83.4 |   87.56 |   91.27 |
  CommentCard.tsx  |   96.29 |    77.27 |     100 |     100 | 40-44,133-142,211
  DiffViewer.tsx   |     100 |      100 |     100 |     100 |
  ...Workspace.tsx |   68.34 |     66.4 |   56.41 |   70.54 | ...04,426,486-490
  ...laceModal.tsx |   89.74 |    78.26 |     100 |   97.14 | 55-59
  MagicBar.tsx     |   93.67 |    91.56 |    92.5 |   95.71 | 145,221,261
  ...extEditor.tsx |   93.51 |    83.07 |     100 |   98.91 | 195
  ...ionsPanel.tsx |   94.94 |     97.5 |   90.62 |    95.4 | 217,467-468,479
  ...trolPanel.tsx |   97.01 |    94.11 |      96 |   96.72 | 316-317
  VisualDiff.tsx   |     100 |      100 |     100 |     100 |
 ...tor/extensions |     100 |    81.25 |   95.83 |     100 |
  CommentMark.ts   |     100 |    81.25 |   95.83 |     100 | 131-132,161
 ...s/editor/hooks |   97.13 |     87.5 |   98.92 |   98.57 |
  useAutoResize.ts |   94.54 |    80.64 |     100 |   95.91 | 100,118
  useBranching.ts  |   93.42 |    83.33 |     100 |    94.2 | 147,153-155
  useChunkIndex.ts |     100 |    93.54 |     100 |     100 | 133-166
  ...entHistory.ts |   95.45 |    80.76 |     100 |   98.73 | 40
  ...rBranching.ts |     100 |    92.85 |     100 |     100 | 52,54,132
  ...orComments.ts |     100 |    92.85 |     100 |     100 | 24
  ...rSelection.ts |   96.77 |    83.33 |     100 |     100 | 89
  ...neComments.ts |   98.46 |    89.47 |     100 |   98.36 | 131
  ...agicEditor.ts |   95.48 |    80.82 |    90.9 |   98.74 | 225-226
  useTiptapSync.ts |     100 |    95.38 |     100 |     100 | 177
 ...ort/components |      92 |      100 |   71.42 |   91.66 |
  ExportModal.tsx  |      92 |      100 |   71.42 |   91.66 | 102-112
 ...s/export/utils |     100 |    85.71 |     100 |     100 |
  exportFormats.ts |     100 |    85.71 |     100 |     100 | 16,44,97
 ...eatures/layout |   94.28 |    91.07 |   89.01 |   95.05 |
  EditorHeader.tsx |   84.61 |       95 |   71.42 |   81.81 | 34,67
  EditorLayout.tsx |   93.33 |    89.09 |      84 |   92.59 | 33,40-41,226
  MainLayout.tsx   |   91.66 |     90.9 |   81.81 |   96.42 | 137
  ...ationRail.tsx |     100 |    96.66 |     100 |     100 | 181
  ToolsPanel.tsx   |   97.36 |    95.83 |     100 |     100 | 150,348-350
  ...Container.tsx |     100 |      100 |     100 |     100 |
  UploadLayout.tsx |     100 |      100 |     100 |     100 |
  Workspace.tsx    |     100 |      100 |     100 |     100 |
  ...deOverlay.tsx |      92 |       65 |   85.71 |    90.9 | 76,98
  index.ts         |       0 |        0 |       0 |       0 |
 ...out/components |   26.15 |     12.5 |      20 |   25.45 |
  FocusHUD.tsx     |   36.36 |    22.22 |    37.5 |   33.33 | ...33-40,48-72,77
  ...etupModal.tsx |    4.76 |        0 |       0 |    6.25 | 11-83
 ...s/layout/store |   84.84 |    86.66 |   81.57 |   86.88 |
  useFocusStore.ts |     100 |      100 |     100 |     100 |
  ...ayoutStore.ts |   81.81 |    84.61 |   78.78 |   84.31 | ...66,174,219-234
 app/features/lore |       0 |        0 |       0 |       0 |
  index.ts         |       0 |        0 |       0 |       0 |
 ...ore/components |   98.03 |    85.12 |   98.03 |   99.38 |
  ...edgeGraph.tsx |   98.29 |    81.37 |     100 |     100 | ...95,406-412,437
  LoreManager.tsx  |   97.54 |    89.24 |   96.61 |   98.16 | 164,395
 ...eatures/memory |    94.5 |    78.57 |   98.57 |   95.67 |
  ...ryManager.tsx |    94.5 |    78.57 |   98.57 |   95.67 | ...19,271-272,329
  index.ts         |       0 |        0 |       0 |       0 |
 ...ory/components |   94.83 |    85.15 |   93.47 |   97.79 |
  ...teHistory.tsx |     100 |      100 |     100 |     100 |
  ...NotePanel.tsx |   93.89 |     80.2 |   91.89 |   97.36 | 253,333,361
  ...fications.tsx |     100 |      100 |     100 |     100 |
 ...atures/project |       0 |        0 |       0 |       0 |
  index.ts         |       0 |        0 |       0 |       0 |
 ...ect/components |   92.05 |    86.25 |   92.59 |   93.46 |
  FileUpload.tsx   |      90 |    92.85 |     100 |   89.65 | 23-25
  ImportWizard.tsx |    92.1 |    86.85 |   91.87 |    94.1 | ...1713-1714,1822
  ...Dashboard.tsx |   88.34 |    76.56 |   94.11 |   89.79 | ...24,234-238,419
  ...ctSidebar.tsx |     100 |       80 |     100 |     100 | 62-77,123,134,139
  StoryBoard.tsx   |   94.59 |    93.93 |    90.9 |   93.54 | 10,85-87
 .../project/store |   97.86 |    84.69 |     100 |    99.4 |
  ...ojectStore.ts |   97.86 |    84.69 |     100 |    99.4 | 97
 ...tures/settings |       0 |        0 |       0 |       0 |
  index.ts         |       0 |        0 |       0 |       0 |
 ...ngs/components |    90.6 |    92.25 |   90.14 |      90 |
  ...eyManager.tsx |     100 |      100 |     100 |     100 |
  ...tSelector.tsx |     100 |      100 |     100 |     100 |
  ...ySelector.tsx |     100 |      100 |     100 |     100 |
  ...odeToggle.tsx |     100 |      100 |     100 |     100 |
  ...eSelector.tsx |   75.75 |       80 |      80 |   75.75 | 90-92,205-215
  ...dSelector.tsx |      88 |    78.26 |    92.3 |   86.95 | 58-60
  ...eckToggle.tsx |     100 |      100 |     100 |     100 |
  ...nceTuning.tsx |     100 |    92.85 |     100 |     100 | 54
  ...eSelector.tsx |      70 |      100 |      50 |      70 | 18,86-96
 ...settings/store |     100 |      100 |     100 |     100 |
  ...tingsStore.ts |     100 |      100 |     100 |     100 |
 ...eatures/shared |     100 |      100 |     100 |     100 |
  animations.ts    |     100 |      100 |     100 |     100 |
  index.ts         |     100 |      100 |     100 |     100 |
 ...red/components |    96.2 |    87.91 |   98.66 |   96.17 |
  ...leTooltip.tsx |      88 |     77.5 |     100 |   87.23 | 56,58,60,62,66,93
  ...ndPalette.tsx |   97.89 |    93.54 |   97.29 |   98.61 | 128
  ...tchenSink.tsx |     100 |      100 |     100 |     100 |
  ...rBoundary.tsx |     100 |      100 |     100 |     100 |
  Icons.tsx        |     100 |      100 |     100 |     100 |
  ...ingScreen.tsx |     100 |      100 |     100 |     100 |
  UsageBadge.tsx   |     100 |      100 |     100 |     100 |
 .../components/ui |     100 |    98.73 |     100 |     100 |
  Button.tsx       |     100 |    94.44 |     100 |     100 | 84
  Card.tsx         |     100 |      100 |     100 |     100 |
  Input.tsx        |     100 |      100 |     100 |     100 |
  Spinner.tsx      |     100 |      100 |     100 |     100 |
  Typography.tsx   |     100 |      100 |     100 |     100 |
 ...shared/context |     100 |    92.85 |     100 |     100 |
  UsageContext.tsx |     100 |    92.85 |     100 |     100 | 83,91-94
 ...s/shared/hooks |   96.86 |     87.8 |   93.75 |   97.33 |
  ...mithEngine.ts |   97.16 |    82.45 |   92.85 |   98.03 | 152-153
  ...iptIndexer.ts |   97.36 |    92.85 |     100 |     100 | 30
  ...telligence.ts |   96.85 |    86.66 |   97.22 |   96.77 | 357-365,403
  ...uggestions.ts |     100 |     87.5 |     100 |     100 | 34
  ...ssPipeline.ts |   98.41 |      100 |   95.23 |     100 |
  ...ttledValue.ts |     100 |    85.71 |     100 |     100 | 31
  ...tCollision.ts |   93.15 |       92 |   76.92 |   92.95 | 188-196
 ...s/shared/utils |   98.42 |    93.75 |     100 |   98.34 |
  diffUtils.ts     |     100 |      100 |     100 |     100 |
  ...Normalizer.ts |     100 |      100 |     100 |     100 |
  ...nValidator.ts |     100 |      100 |     100 |     100 |
  textLocator.ts   |   98.03 |    92.59 |     100 |   97.97 | 51,64
  textReplacer.ts  |     100 |      100 |     100 |     100 |
 ...features/voice |       0 |        0 |       0 |       0 |
  index.ts         |       0 |        0 |       0 |       0 |
 ...ice/components |   95.45 |    92.53 |     100 |   96.29 |
  ...andButton.tsx |     100 |      100 |     100 |     100 |
  VoiceMode.tsx    |   92.98 |    85.71 |     100 |   94.33 | 29,93-94
 ...es/voice/hooks |   93.03 |    84.61 |   92.68 |   94.35 |
  ...Controller.ts |   91.75 |    83.72 |   84.61 |   92.55 | 145,215,256-262
  ...eechIntent.ts |   97.67 |    88.88 |     100 |     100 | 15
  ...xtToSpeech.ts |   95.83 |    86.36 |     100 |     100 | 41,60-70
  ...iceSession.ts |    91.4 |    83.72 |    92.3 |   91.86 | 233-246
 ...voice/services |     100 |      100 |     100 |     100 |
  audioUtils.ts    |     100 |      100 |     100 |     100 |
 app/public        |     100 |      100 |     100 |     100 |
  ...-processor.js |     100 |      100 |     100 |     100 |
 app/services      |   95.73 |    84.61 |     100 |   96.56 |
  db.ts            |     100 |      100 |     100 |     100 |
  ...iptIndexer.ts |   92.59 |    88.46 |     100 |   95.91 | 26-27
  ...riptParser.ts |   98.57 |    83.33 |     100 |     100 | ...22,134,139-144
  pdfExport.ts     |   95.34 |    83.92 |     100 |   95.29 | 52-57,60,157-158
 ...services/agent |     100 |       75 |     100 |     100 |
  readerService.ts |     100 |       75 |     100 |     100 | 89-92
 ...vices/appBrain |    97.2 |    90.39 |   96.42 |   97.44 |
  ...iveContext.ts |   97.34 |    90.47 |     100 |   97.58 | 511,703,856-860
  ...extBuilder.ts |     100 |    86.06 |     100 |     100 | ...86-491,499,584
  ...xtStreamer.ts |     100 |      100 |     100 |     100 |
  ...terContext.ts |   98.79 |    93.61 |     100 |   98.64 | 214-215
  ...ingService.ts |     100 |    94.44 |     100 |     100 | 83
  driftDetector.ts |     100 |    93.93 |     100 |     100 | 89,124
  eventBus.ts      |   95.07 |    90.24 |     100 |   96.37 | 24-28,241
  eventObserver.ts |     100 |      100 |     100 |     100 |
  ...ackTracker.ts |   96.66 |     90.9 |     100 |     100 | 22
  index.ts         |     100 |      100 |     100 |     100 |
  ...moryBridge.ts |     100 |    85.18 |     100 |     100 | ...60-375,401,563
  logger.ts        |   96.72 |      100 |   94.73 |   96.66 | 182,200
  ...eAlignment.ts |   94.11 |      100 |     100 |   94.11 | 78
  ...iveThinker.ts |   96.56 |    92.36 |   93.33 |   96.96 | ...-937,1052-1054
  runtime.ts       |   89.61 |    74.19 |   73.33 |   89.47 | ...77-180,272-279
  ...ditMonitor.ts |   85.71 |       80 |   82.35 |   86.66 | ...40,156-159,169
  types.ts         |       0 |        0 |       0 |       0 |
 ...vices/commands |   94.11 |    95.36 |   81.17 |   93.84 |
  analysis.ts      |     100 |      100 |     100 |     100 |
  editing.ts       |     100 |      100 |     100 |     100 |
  generation.ts    |     100 |      100 |     100 |     100 |
  history.ts       |   98.55 |    96.66 |     100 |    98.3 | 191
  index.ts         |       0 |        0 |       0 |       0 |
  knowledge.ts     |     100 |    85.18 |     100 |     100 | 29,57-59
  navigation.ts    |     100 |    95.65 |     100 |     100 | 41,123
  registry.ts      |   64.44 |      100 |   40.74 |   63.63 | ...25,234,242,250
  ui.ts            |     100 |      100 |     100 |     100 |
 app/services/core |   94.37 |    90.51 |    97.4 |   94.52 |
  ...Controller.ts |   97.91 |    85.71 |     100 |   97.91 | 286,478
  ...oordinator.ts |   88.88 |      100 |   81.81 |   90.32 | 95-97
  ...extBuilder.ts |     100 |       92 |     100 |     100 | 72,75
  ...torMachine.ts |   91.66 |    83.33 |     100 |   91.66 | 100
  agentSession.ts  |   82.69 |    83.72 |     100 |   82.35 | 70-80,96
  ...ateFactory.ts |     100 |      100 |     100 |     100 |
  agentToolLoop.ts |     100 |      100 |     100 |     100 |
  ...extService.ts |     100 |      100 |     100 |     100 |
  promptBuilder.ts |     100 |      100 |     100 |     100 |
  ...allAdapter.ts |     100 |      100 |     100 |     100 |
  toolRunner.ts    |   95.45 |    88.63 |     100 |   95.31 | 117,163,192
 ...ervices/gemini |   98.54 |    90.97 |   99.25 |    98.6 |
  agent.ts         |     100 |      100 |     100 |     100 |
  agentTools.ts    |   96.55 |       90 |     100 |   96.42 | 13
  analysis.ts      |     100 |    93.54 |     100 |     100 | 67,297
  audio.ts         |   96.22 |    85.71 |    90.9 |   96.07 | 38,97
  client.ts        |    97.1 |    83.78 |     100 |   97.05 | 106,188
  ...quePrompts.ts |     100 |      100 |     100 |     100 |
  ...ct-actions.ts |     100 |    94.44 |     100 |     100 | 70
  errors.ts        |     100 |      100 |     100 |     100 |
  ...ncePrompts.ts |     100 |      100 |     100 |     100 |
  factory.ts       |     100 |    96.15 |     100 |     100 | 219
  grammar.ts       |     100 |      100 |     100 |     100 |
  ...olHandlers.ts |   99.23 |    86.81 |     100 |     100 | ...91-296,325,393
  prompts.ts       |     100 |      100 |     100 |     100 |
  ...ientParser.ts |   98.57 |    97.22 |     100 |   98.57 | 18
  serializers.ts   |     100 |    89.74 |     100 |     100 | ...5,66-69,99,121
  tokenGuard.ts    |   97.61 |     92.3 |     100 |   97.61 | 75
  toolExecutor.ts  |   97.18 |    89.93 |     100 |   97.07 | 34-36,186,217,436
 ...s/intelligence |    97.6 |    89.04 |   97.17 |   98.72 |
  cache.ts         |   97.11 |    97.05 |   94.44 |   97.05 | 73-75
  chunkIndex.ts    |   97.41 |    82.72 |   97.91 |   99.51 | 419
  chunkManager.ts  |   94.48 |    86.23 |   95.23 |   95.58 | ...98,756-757,783
  ...extBuilder.ts |   99.37 |    85.71 |   93.33 |   99.35 | 57
  ...onDetector.ts |   95.81 |    84.25 |     100 |   97.35 | ...16,565,612,639
  deltaTracker.ts  |   99.21 |    89.47 |     100 |   99.16 | 129
  ...yExtractor.ts |   97.64 |    88.19 |   94.28 |   99.35 | 110,446
  ...mapBuilder.ts |   97.84 |    97.22 |   91.17 |   97.72 | 282-287,316
  ...lProcessor.ts |   99.18 |    90.66 |     100 |     100 | ...75-176,316-317
  index.ts         |   99.14 |    82.97 |     100 |     100 | ...54,299-303,398
  narrativeArc.ts  |   98.87 |    90.75 |     100 |   99.34 | 331
  sceneEmbedder.ts |   96.41 |    83.14 |   93.93 |   98.15 | 255,400,424
  ...uralParser.ts |   96.66 |    93.16 |   95.34 |   98.02 | 118-119,213,491
  styleAnalyzer.ts |   97.75 |     92.4 |     100 |   99.33 | 468
  ...ineTracker.ts |   97.67 |     91.3 |     100 |     100 | ...94,201-203,205
  voiceProfiler.ts |   98.51 |    94.87 |     100 |     100 | 108-112,151,193
  worker.ts        |     100 |    86.36 |     100 |     100 | 213-239
  workerPool.ts    |     100 |    97.87 |     100 |     100 | 348
 app/services/io   |     100 |      100 |     100 |     100 |
  docxExporter.ts  |     100 |      100 |     100 |     100 |
  docxImporter.ts  |     100 |      100 |     100 |     100 |
  ...riptExport.ts |     100 |      100 |     100 |     100 |
 ...ervices/memory |   96.65 |    90.73 |   94.71 |   97.61 |
  autoObserver.ts  |   95.18 |    94.15 |     100 |   94.79 | ...25,338,465,493
  ...Embeddings.ts |     100 |      100 |     100 |     100 |
  ...torySearch.ts |      92 |    92.59 |     100 |     100 | 20-21
  ...eMutations.ts |   98.71 |    88.46 |     100 |   98.61 | 119
  ...Serializer.ts |    90.4 |    82.35 |   88.23 |   91.58 | ...48,186-188,199
  cache.ts         |   94.91 |    89.79 |    91.3 |   95.65 | 189-192,244
  chains.ts        |     100 |    89.74 |     100 |     100 | ...61,569,698-705
  consolidation.ts |   95.62 |    90.69 |   88.88 |   98.14 | 372,546-547
  dreaming.ts      |     100 |    88.88 |     100 |     100 | 79,97-98
  factExtractor.ts |    99.1 |    94.44 |     100 |   99.06 | 371
  goalGraph.ts     |    98.3 |    88.88 |     100 |   99.38 | 402
  index.ts         |   92.68 |    87.87 |   76.47 |   93.69 | ...47,150-157,239
  memoryQueries.ts |   94.56 |    88.88 |    87.5 |   97.56 | 24,88
  memoryScoring.ts |    97.5 |    96.87 |     100 |   97.22 | 99
  memoryService.ts |     100 |      100 |     100 |     100 |
  proactive.ts     |    98.8 |    90.76 |     100 |     100 | 80,107-128,220
  ...meTriggers.ts |   94.91 |    84.48 |     100 |     100 | ...18-134,241,348
  relevance.ts     |     100 |      100 |     100 |     100 |
  semanticDedup.ts |   95.31 |    93.44 |   86.95 |   94.73 | 64-72
  ...nLifecycle.ts |     100 |      100 |     100 |     100 |
  ...ionTracker.ts |     100 |    96.87 |     100 |     100 | 210
  types.ts         |     100 |      100 |     100 |     100 |
  voiceProfiles.ts |     100 |      100 |     100 |     100 |
 ...memory/bedside |     100 |    83.33 |     100 |     100 |
  schema.ts        |     100 |    83.33 |     100 |     100 | 22
 ...ices/telemetry |     100 |      100 |     100 |     100 |
  errorReporter.ts |     100 |      100 |     100 |     100 |
 ...ests/factories |     100 |      100 |     100 |     100 |
  ...ultFactory.ts |     100 |      100 |     100 |     100 |
 app/tests/helpers |   96.29 |      100 |   93.75 |   96.29 |
  testUtils.ts     |   96.29 |      100 |   93.75 |   96.29 | 153
 app/tests/mocks   |   98.18 |      100 |      92 |     100 |
  geminiClient.ts  |   97.05 |      100 |   77.77 |     100 |
  testFactories.ts |     100 |      100 |     100 |     100 |
-------------------|---------|----------|---------|---------|-------------------
ERROR: Coverage for branches (88.86%) does not meet global threshold (90%)
