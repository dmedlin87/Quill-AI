<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quill AI - Intelligent Book Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Literata:ital,opsz,wght@0,7..72,300;0,7..72,400;0,7..72,500;0,7..72,600;0,7..72,700;1,7..72,300;1,7..72,400;1,7..72,500&family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
      :root {
        /* ═══════════════════════════════════════════════════════════
           BASE PALETTE - Raw color values (theme-agnostic)
           ═══════════════════════════════════════════════════════════ */
        
        /* Ink Scale - Warm charcoals */
        --ink-950: #0a0908;
        --ink-900: #1a1815;
        --ink-800: #2d2a26;
        --ink-700: #3d3935;
        --ink-600: #524d47;
        --ink-500: #6b6560;
        --ink-400: #8a847d;
        --ink-300: #a9a49e;
        --ink-200: #ccc8c3;
        --ink-100: #e8e6e3;
        --ink-50: #f6f5f3;
        
        /* Parchment Scale - Warm whites */
        --parchment-50: #fdfcfa;
        --parchment-100: #faf8f5;
        --parchment-200: #f5f2ed;
        --parchment-300: #eae5dc;
        --parchment-400: #ddd6c9;
        
        /* Dark Academia Scale - Deep charcoals & obsidian */
        --obsidian-950: #09090b;
        --obsidian-900: #111114;
        --obsidian-800: #18181b;
        --obsidian-700: #222226;
        --obsidian-600: #2c2c31;
        --obsidian-500: #3f3f46;
        --obsidian-400: #52525b;
        --obsidian-300: #71717a;
        --obsidian-200: #a1a1aa;
        --obsidian-100: #d4d4d8;
        
        /* Accent - Aged Gold / Magic */
        --magic-600: #a68518;
        --magic-500: #c9a227;
        --magic-400: #dbb635;
        --magic-300: #e8c84d;
        --magic-200: #f2dc8a;
        --magic-100: #faf3d4;
        --magic-glow: rgba(201, 162, 39, 0.4);
        --magic-glow-dark: rgba(219, 182, 53, 0.25);
        
        /* Semantic - Muted, sophisticated */
        --error-500: #b54248;
        --error-400: #dc4f56;
        --error-100: #fdeeed;
        --error-900: #3b1518;
        --success-500: #4a8f6d;
        --success-400: #5aab82;
        --success-100: #e8f5ee;
        --success-900: #14291f;
        --warning-500: #b8863b;
        --warning-400: #d49a47;
        --warning-100: #fdf5e9;
        --warning-900: #2d1f0a;
        
        /* ═══════════════════════════════════════════════════════════
           TYPOGRAPHY SYSTEM - "Living Manuscript"
           ═══════════════════════════════════════════════════════════ */
        
        /* Font Families */
        --font-serif: 'Literata', 'Georgia', 'Times New Roman', serif;
        --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
        --font-mono: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
        
        /* Prose (Editor) Typography */
        --prose-size: clamp(16px, 2.5vw, 20px);
        --prose-line-height: 1.85;
        --prose-paragraph-spacing: 1.5em;
        --prose-max-width: 65ch;
        
        /* UI Typography Scale (1.25 ratio) */
        --text-xs: 0.75rem;
        --text-sm: 0.875rem;
        --text-base: 1rem;
        --text-lg: 1.25rem;
        --text-xl: 1.563rem;
        --text-2xl: 1.953rem;
        --text-3xl: 2.441rem;
        --text-4xl: 3.052rem;
        
        /* Line Heights */
        --line-height-tight: 1.25;
        --line-height-snug: 1.375;
        --line-height-normal: 1.5;
        --line-height-relaxed: 1.625;
        --line-height-loose: 1.75;
        --line-height-prose: 1.85;
        
        /* Letter Spacing */
        --tracking-tighter: -0.05em;
        --tracking-tight: -0.025em;
        --tracking-normal: 0;
        --tracking-wide: 0.025em;
        --tracking-wider: 0.05em;
        --tracking-widest: 0.1em;
        
        /* Spacing Scale (8px base) */
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.25rem;
        --space-6: 1.5rem;
        --space-8: 2rem;
        --space-10: 2.5rem;
        --space-12: 3rem;
        --space-16: 4rem;
        --space-20: 5rem;
        
        /* Radii */
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
        --radius-xl: 16px;
        --radius-full: 9999px;
        
        /* Transitions */
        --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
        --ease-out-back: cubic-bezier(0.34, 1.56, 0.64, 1);
        --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
        --duration-fast: 150ms;
        --duration-normal: 250ms;
        --duration-slow: 400ms;
        --duration-slower: 600ms;
      }

      /* ═══════════════════════════════════════════════════════════
         LIGHT THEME - Warm Parchment (Default)
         ═══════════════════════════════════════════════════════════ */
      :root, [data-theme="light"] {
        /* Surface colors */
        --surface-primary: var(--parchment-50);
        --surface-secondary: var(--parchment-100);
        --surface-tertiary: var(--parchment-200);
        --surface-elevated: #ffffff;
        --surface-overlay: rgba(250, 248, 245, 0.85);
        
        /* Text colors */
        --text-primary: var(--ink-800);
        --text-secondary: var(--ink-600);
        --text-tertiary: var(--ink-400);
        --text-muted: var(--ink-300);
        --text-inverse: var(--parchment-50);
        
        /* Border colors */
        --border-primary: var(--ink-100);
        --border-secondary: var(--ink-200);
        --border-subtle: rgba(45, 42, 38, 0.08);
        
        /* Interactive states */
        --interactive-bg: var(--parchment-200);
        --interactive-bg-hover: var(--ink-100);
        --interactive-bg-active: var(--magic-100);
        --interactive-accent: var(--magic-500);
        --interactive-accent-hover: var(--magic-400);
        
        /* Component specific */
        --nav-bg: var(--parchment-50);
        --sidebar-bg: var(--parchment-50);
        --editor-bg: var(--parchment-200);
        --card-bg: var(--surface-elevated);
        --modal-backdrop: rgba(26, 24, 21, 0.6);
        
        /* Shadows */
        --shadow-sm: 0 1px 2px rgba(10, 9, 8, 0.04);
        --shadow-md: 0 2px 4px rgba(10, 9, 8, 0.04), 0 4px 8px rgba(10, 9, 8, 0.06);
        --shadow-lg: 0 4px 8px rgba(10, 9, 8, 0.04), 0 8px 16px rgba(10, 9, 8, 0.06), 0 16px 32px rgba(10, 9, 8, 0.08);
        --shadow-xl: 0 8px 16px rgba(10, 9, 8, 0.06), 0 16px 32px rgba(10, 9, 8, 0.08), 0 32px 64px rgba(10, 9, 8, 0.12);
        --shadow-magic: 0 0 0 1px var(--magic-200), 0 4px 16px var(--magic-glow), 0 8px 32px rgba(201, 162, 39, 0.2);
        --shadow-glass: 0 8px 32px rgba(10, 9, 8, 0.12), inset 0 1px 0 rgba(255, 255, 255, 0.5);
        
        /* Glassmorphism */
        --glass-bg: rgba(253, 252, 250, 0.72);
        --glass-border: rgba(255, 255, 255, 0.5);
        --glass-blur: 16px;
      }

      /* ═══════════════════════════════════════════════════════════
         DARK THEME - Dark Academia
         ═══════════════════════════════════════════════════════════ */
      [data-theme="dark"] {
        /* Surface colors */
        --surface-primary: var(--obsidian-900);
        --surface-secondary: var(--obsidian-800);
        --surface-tertiary: var(--obsidian-700);
        --surface-elevated: var(--obsidian-800);
        --surface-overlay: rgba(17, 17, 20, 0.9);
        
        /* Text colors */
        --text-primary: var(--obsidian-100);
        --text-secondary: var(--obsidian-200);
        --text-tertiary: var(--obsidian-300);
        --text-muted: var(--obsidian-400);
        --text-inverse: var(--obsidian-900);
        
        /* Border colors */
        --border-primary: var(--obsidian-700);
        --border-secondary: var(--obsidian-600);
        --border-subtle: rgba(255, 255, 255, 0.06);
        
        /* Interactive states */
        --interactive-bg: var(--obsidian-700);
        --interactive-bg-hover: var(--obsidian-600);
        --interactive-bg-active: rgba(201, 162, 39, 0.15);
        --interactive-accent: var(--magic-400);
        --interactive-accent-hover: var(--magic-300);
        
        /* Component specific */
        --nav-bg: var(--obsidian-900);
        --sidebar-bg: var(--obsidian-800);
        --editor-bg: var(--obsidian-950);
        --card-bg: var(--obsidian-800);
        --modal-backdrop: rgba(9, 9, 11, 0.8);
        
        /* Remap parchment → obsidian for existing code compatibility */
        --parchment-50: var(--obsidian-800);
        --parchment-100: var(--obsidian-900);
        --parchment-200: var(--obsidian-950);
        
        /* Remap ink scale for dark mode */
        --ink-50: var(--obsidian-100);
        --ink-100: var(--obsidian-700);
        --ink-200: var(--obsidian-600);
        --ink-300: var(--obsidian-400);
        --ink-400: var(--obsidian-300);
        --ink-500: var(--obsidian-200);
        --ink-600: var(--obsidian-200);
        --ink-700: var(--obsidian-100);
        --ink-800: var(--obsidian-100);
        --ink-900: var(--obsidian-50);
        
        /* Shadows - deeper for dark mode */
        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.2);
        --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.2), 0 4px 8px rgba(0, 0, 0, 0.25);
        --shadow-lg: 0 4px 8px rgba(0, 0, 0, 0.2), 0 8px 16px rgba(0, 0, 0, 0.25), 0 16px 32px rgba(0, 0, 0, 0.3);
        --shadow-xl: 0 8px 16px rgba(0, 0, 0, 0.25), 0 16px 32px rgba(0, 0, 0, 0.3), 0 32px 64px rgba(0, 0, 0, 0.35);
        --shadow-magic: 0 0 0 1px rgba(219, 182, 53, 0.3), 0 4px 16px var(--magic-glow-dark), 0 8px 32px rgba(201, 162, 39, 0.15);
        --shadow-glass: 0 8px 32px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.05);
        
        /* Glassmorphism */
        --glass-bg: rgba(24, 24, 27, 0.75);
        --glass-border: rgba(255, 255, 255, 0.08);
        --glass-blur: 20px;
        
        /* Semantic colors - darker variants */
        --error-100: var(--error-900);
        --success-100: var(--success-900);
        --warning-100: var(--warning-900);
        --magic-100: rgba(201, 162, 39, 0.15);
      }

      /* ═══════════════════════════════════════════════════════════
         GLOBAL STYLES - Living Manuscript Foundation
         ═══════════════════════════════════════════════════════════ */
      body {
        font-family: var(--font-sans);
        background-color: var(--surface-secondary);
        color: var(--text-primary);
        line-height: var(--line-height-normal);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
      }

      /* Headings - Elegant Serif */
      h1, h2, h3, h4, h5, h6, .font-serif {
        font-family: var(--font-serif);
        font-weight: 500;
        letter-spacing: var(--tracking-tight);
      }
      
      h1 { font-size: var(--text-3xl); line-height: var(--line-height-tight); }
      h2 { font-size: var(--text-2xl); line-height: var(--line-height-tight); }
      h3 { font-size: var(--text-xl); line-height: var(--line-height-snug); }
      h4 { font-size: var(--text-lg); line-height: var(--line-height-snug); }
      
      /* Monospace for code/stats */
      code, pre, .font-mono {
        font-family: var(--font-mono);
        font-size: 0.9em;
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: var(--ink-200);
        border-radius: var(--radius-full);
      }
      ::-webkit-scrollbar-thumb:hover {
        background: var(--ink-300);
      }

      /* Animations */
      @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
      @keyframes slideUp { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
      @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
      @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
      @keyframes sparkle {
        0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
        50% { opacity: 1; transform: scale(1) rotate(180deg); }
      }
      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-4px); }
      }

      .animate-fade-in { animation: fadeIn var(--duration-normal) var(--ease-out-expo); }
      .animate-slide-up { animation: slideUp var(--duration-slow) var(--ease-out-expo); }
      .animate-scale-in { animation: scaleIn var(--duration-normal) var(--ease-out-back); }

      /* ═══════════════════════════════════════════════════════════
         PROSEMIRROR / TIPTAP - Reading-Optimized Editor
         ═══════════════════════════════════════════════════════════ */
      .ProseMirror {
        outline: none;
        min-height: 60vh;
        font-family: var(--font-serif);
        font-size: var(--prose-size);
        line-height: var(--prose-line-height);
        color: var(--text-primary);
        white-space: pre-wrap;
        max-width: var(--prose-max-width);
        margin: 0 auto;
        
        /* Optical adjustments for reading */
        font-feature-settings: 'kern' 1, 'liga' 1, 'calt' 1;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        
        /* Subtle text shadow for warmth */
        text-shadow: 0 0 1px rgba(0, 0, 0, 0.04);
      }
      
      .ProseMirror p {
        margin-bottom: var(--prose-paragraph-spacing);
      }
      
      .ProseMirror p:first-child {
        margin-top: 0;
      }
      
      .ProseMirror p:last-child {
        margin-bottom: 0;
      }
      
      .ProseMirror-selectednode {
        outline: 2px solid var(--magic-400);
        outline-offset: 2px;
        border-radius: var(--radius-sm);
      }
      
      /* Selection styling */
      .ProseMirror ::selection {
        background: var(--magic-200);
        color: var(--ink-900);
      }
      
      /* Focus mode enhancement */
      .ProseMirror.zen-mode {
        font-size: calc(var(--prose-size) * 1.1);
        line-height: var(--line-height-prose);
        max-width: 60ch;
      }

      /* ═══════════════════════════════════════════════════════════
         EDITOR DECORATIONS - Analysis & Comment Highlights
         CSS classes instead of inline styles for performance
         ═══════════════════════════════════════════════════════════ */
      
      /* Base decoration styles */
      .decoration-base {
        cursor: help;
        border-bottom-width: 2px;
        border-bottom-style: solid;
        transition: background-color 150ms ease;
      }
      
      /* Error severity (red) */
      .decoration-error {
        background-color: rgba(239, 68, 68, 0.15);
        border-bottom-color: rgb(239, 68, 68);
      }
      .decoration-error:hover {
        background-color: rgba(239, 68, 68, 0.25);
      }
      
      /* Warning severity (amber) */
      .decoration-warning {
        background-color: rgba(245, 158, 11, 0.15);
        border-bottom-color: rgb(245, 158, 11);
      }
      .decoration-warning:hover {
        background-color: rgba(245, 158, 11, 0.25);
      }
      
      /* Info severity (indigo) */
      .decoration-info {
        background-color: rgba(99, 102, 241, 0.12);
        border-bottom-color: rgb(99, 102, 241);
      }
      .decoration-info:hover {
        background-color: rgba(99, 102, 241, 0.22);
      }
      
      /* Success (green) */
      .decoration-success {
        background-color: rgba(34, 197, 94, 0.15);
        border-bottom-color: rgb(34, 197, 94);
      }
      
      /* Analysis highlight (gold) */
      .decoration-analysis {
        background-color: rgba(201, 162, 39, 0.12);
        border-bottom-color: rgb(201, 162, 39);
      }
      .decoration-analysis:hover {
        background-color: rgba(201, 162, 39, 0.22);
      }
      
      /* Inline comment highlight - clickable */
      .inline-comment-highlight {
        cursor: pointer;
        transition: background-color 150ms ease, transform 50ms ease;
      }
      .inline-comment-highlight:hover {
        filter: brightness(1.1);
      }
      
      /* Utilities */
      .paper-shadow { box-shadow: var(--shadow-lg); }
      
      /* ═══════════════════════════════════════════════════════════
         GLASSMORPHISM UTILITY
         Modern frosted glass effect for floating UI elements
         ═══════════════════════════════════════════════════════════ */
      .glass {
        background: var(--glass-bg);
        backdrop-filter: blur(var(--glass-blur));
        -webkit-backdrop-filter: blur(var(--glass-blur));
        border: 1px solid var(--glass-border);
        box-shadow: var(--shadow-glass);
      }
      
      .glass-subtle {
        background: var(--glass-bg);
        backdrop-filter: blur(calc(var(--glass-blur) * 0.5));
        -webkit-backdrop-filter: blur(calc(var(--glass-blur) * 0.5));
        border: 1px solid var(--glass-border);
      }
      
      .glass-strong {
        background: var(--glass-bg);
        backdrop-filter: blur(calc(var(--glass-blur) * 1.5));
        -webkit-backdrop-filter: blur(calc(var(--glass-blur) * 1.5));
        border: 1px solid var(--glass-border);
        box-shadow: var(--shadow-glass), 0 0 1px rgba(255, 255, 255, 0.1) inset;
      }
      
      /* Dark mode scrollbar */
      [data-theme="dark"] ::-webkit-scrollbar-thumb {
        background: var(--obsidian-600);
      }
      [data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
        background: var(--obsidian-500);
      }
      
      /* Theme transition */
      body, .theme-transition, .theme-transition * {
        transition: background-color var(--duration-slow) var(--ease-out-expo),
                    border-color var(--duration-slow) var(--ease-out-expo),
                    color var(--duration-normal) var(--ease-out-expo);
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0",
    "react": "https://esm.sh/react@18.3.1",
    "react/": "https://esm.sh/react@18.3.1/",
    "react-dom": "https://esm.sh/react-dom@18.3.1",
    "react-dom/": "https://esm.sh/react-dom@18.3.1/",
    "zustand": "https://esm.sh/zustand@4.5.2?external=react",
    "jspdf": "https://esm.sh/jspdf@2.5.1",
    "dexie": "https://esm.sh/dexie@3.2.4",
    "diff": "https://esm.sh/diff@5.2.0",
    "diff-match-patch": "https://esm.sh/diff-match-patch@1.0.5",
    "@tiptap/core": "https://esm.sh/@tiptap/core@2.2.4?external=react,react-dom",
    "@tiptap/starter-kit": "https://esm.sh/@tiptap/starter-kit@2.2.4?external=react,react-dom",
    "@tiptap/extension-highlight": "https://esm.sh/@tiptap/extension-highlight@2.2.4?external=react,react-dom",
    "@tiptap/react": "https://esm.sh/@tiptap/react@2.2.4?external=react,react-dom",
    "tiptap-markdown": "https://esm.sh/tiptap-markdown@0.8.10?external=react,react-dom",
    "@tiptap/pm": "https://esm.sh/@tiptap/pm@2.2.4",
    "@tiptap/pm/": "https://esm.sh/@tiptap/pm@2.2.4/",
    "framer-motion": "https://esm.sh/framer-motion@11.0.8?external=react,react-dom"
  }
}
</script>
</head>
  <body>
    <div id="root"></div>
    <script type="module" src="/index.tsx"></script>
  </body>
</html>
